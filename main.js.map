{"version":3,"sources":["/home/runner/work/foto-app-arat/foto-app-arat/src/persistence.ts","/home/runner/work/foto-app-arat/foto-app-arat/node_modules/hyperapp/index.js","/home/runner/work/foto-app-arat/foto-app-arat/src/media.ts","/home/runner/work/foto-app-arat/foto-app-arat/src/utils.ts","/home/runner/work/foto-app-arat/foto-app-arat/src/translator.ts","/home/runner/work/foto-app-arat/foto-app-arat/src/constants.ts","/home/runner/work/foto-app-arat/foto-app-arat/src/dom.ts","/home/runner/work/foto-app-arat/foto-app-arat/src/types.ts","/home/runner/work/foto-app-arat/foto-app-arat/src/actions.ts","/home/runner/work/foto-app-arat/foto-app-arat/src/components.ts","/home/runner/work/foto-app-arat/foto-app-arat/src/main.ts"],"sourcesContent":["/**\n * Takes a IDBRequest and returns a promise that resolves\n * to the target.result property of the onsuccess Event\n *\n * This helper function is used in PhotoDB to convert the callback-based\n * IndexedDB API into a more convinient promise-based API\n */\nfunction resultPromise<T>(v: IDBRequest<T>): Promise<T> {\n  return new Promise((resolve) => {\n    v.onsuccess = (e) => resolve((e.target as any).result);\n  });\n}\n\nexport type Film = {\n  id: number;\n  photos: number[];\n  developmentStartDate?: number;\n  frames: number;\n};\n\nexport type Photo = string;\n\nconst DB_NAME = \"Foto-App-Arat\";\nconst PHOTO_STORE = \"photos\";\nconst FILM_STORE = \"films\";\nconst CONFIG_STORE = \"config\";\n\nconst ACTIVE_FILM_CONFIG_KEY = \"active_film_id\";\nconst DEVELOPED_PHOTOS_CONFIG_KEY = \"developed_photos\";\n\nclass PhotoDB {\n  private idb: IDBDatabase;\n\n  constructor(cb: () => void) {\n    const dbRequest: IDBOpenDBRequest = window.indexedDB.open(DB_NAME, 8);\n\n    dbRequest.onerror = (event) => console.error(\"DB init failed\", event);\n    dbRequest.onupgradeneeded = (event) => {\n      const idb: IDBDatabase = (event.target as any).result as IDBDatabase;\n      idb.createObjectStore(PHOTO_STORE, { autoIncrement: true });\n      const film_store = idb.createObjectStore(FILM_STORE, {\n        autoIncrement: true,\n        keyPath: \"id\",\n      });\n      const config_store = idb.createObjectStore(CONFIG_STORE);\n\n      // Initialize the active film with a new empty film\n      film_store.put({ photos: [], frames: 8 }).onsuccess = (e) => {\n        config_store.put((e.target as any).result, ACTIVE_FILM_CONFIG_KEY);\n      };\n      config_store.put([], DEVELOPED_PHOTOS_CONFIG_KEY);\n\n      console.log(\"[PhotoDB] created new DB\");\n    };\n\n    dbRequest.onsuccess = (event) => {\n      const idb: IDBDatabase = (event.target as any).result as IDBDatabase;\n      this.idb = idb;\n      idb.onerror = (event) =>\n        console.error(\"[PhotoDB] Database error: \", (event.target as any).errorCode);\n      cb();\n    };\n  }\n\n  getStore(name: string) {\n    return this.idb.transaction([name], \"readwrite\").objectStore(name);\n  }\n\n  getPhotoStore() {\n    return this.getStore(PHOTO_STORE);\n  }\n  getFilmStore() {\n    return this.getStore(FILM_STORE);\n  }\n  getConfigStore() {\n    return this.getStore(CONFIG_STORE);\n  }\n\n  addPhoto(photo: Photo): Promise<number> {\n    return resultPromise(this.getPhotoStore().add(photo) as IDBRequest<number>);\n  }\n\n  loadPhoto(id: number) {\n    return resultPromise(this.getPhotoStore().get(id));\n  }\n\n  addFilm() {\n    return resultPromise(this.getFilmStore().add({ photos: [], frames: 8 }) as IDBRequest<number>);\n  }\n  loadFilm(id: number): Promise<Film> {\n    return resultPromise(this.getFilmStore().get(id));\n  }\n  putFilm(film: Film) {\n    return resultPromise(this.getFilmStore().put(film));\n  }\n  deleteFilm(id: number) {\n    return resultPromise(this.getFilmStore().delete(id));\n  }\n  loadAllFilms(): Promise<Film[]> {\n    return resultPromise(this.getFilmStore().getAll());\n  }\n\n  setConfig(key: string, value: any) {\n    return resultPromise(this.getConfigStore().put(value, key));\n  }\n  loadConfig(key: string): any {\n    return resultPromise(this.getConfigStore().get(key));\n  }\n  setActiveFilmId(id: number) {\n    return this.setConfig(ACTIVE_FILM_CONFIG_KEY, id);\n  }\n  loadActiveFilmId(): Promise<number> {\n    return this.loadConfig(ACTIVE_FILM_CONFIG_KEY);\n  }\n  async loadActiveFilm(): Promise<Film> {\n    const filmId = await this.loadActiveFilmId();\n    return await this.loadFilm(filmId);\n  }\n  loadDevelopedPhotoIds(): Promise<number[]> {\n    return this.loadConfig(DEVELOPED_PHOTOS_CONFIG_KEY);\n  }\n\n  async addDevelopedPhotos(newPhotos: number[]) {\n    let photos = await this.loadDevelopedPhotoIds();\n    photos = photos.concat(newPhotos);\n    return await this.setConfig(DEVELOPED_PHOTOS_CONFIG_KEY, photos);\n  }\n\n  async loadAllDevelopedPhotos(): Promise<Photo[]> {\n    const photos = await this.loadDevelopedPhotoIds();\n    return await Promise.all(photos.map((photoId) => this.loadPhoto(photoId)));\n  }\n\n  /**\n   * Add the given photo to the film with the provided id\n   * resolves to the new film\n   */\n  async addPhotoToFilm(filmId: number, photo: Photo): Promise<Film> {\n    //FIXME: wong return type to test typescript\n    const [photoId, film] = await Promise.all([this.addPhoto(photo), this.loadFilm(filmId)]);\n    film.photos.push(photoId);\n    await this.putFilm(film);\n    return film;\n  }\n\n  async addPhotoToActiveFilm(photo: Photo): Promise<Film> {\n    const filmId = await this.loadActiveFilmId();\n    return await this.addPhotoToFilm(filmId, photo);\n  }\n\n  /**\n   * Takes the photos of the given film and adds them to the list of developed photos\n   * This also removes that film and return the film\n   */\n  async developFilm(filmId: number): Promise<Film> {\n    const film = await this.loadFilm(filmId);\n    await Promise.all([this.addDevelopedPhotos(film.photos), this.deleteFilm(filmId)]);\n    return film;\n  }\n\n  async loadAllFilmsInDevelopment(): Promise<Film[]> {\n    const [activeFilmId, allFilms] = await Promise.all([\n      this.loadActiveFilmId(),\n      this.loadAllFilms(),\n    ]);\n    const activeIndex = allFilms.findIndex((film) => film.id === activeFilmId);\n    if (activeIndex !== -1) {\n      allFilms.splice(activeIndex, 1);\n    }\n    return allFilms;\n  }\n\n  async addDevelopmentStartTimeStampToFilm(filmId: number, timestamp: number) {\n    const film = await this.loadFilm(filmId);\n    film.developmentStartDate = timestamp;\n    return await this.putFilm(film);\n  }\n\n  deleteDatabase() {\n    window.indexedDB.deleteDatabase(DB_NAME);\n  }\n}\n\nexport let db: PhotoDB = null;\n\nexport function initdb(): Promise<void> {\n  return new Promise((resolve) => {\n    db = new PhotoDB(() => {\n      resolve(null);\n    });\n  });\n}\n","var SSR_NODE = 1\nvar TEXT_NODE = 3\nvar EMPTY_OBJ = {}\nvar EMPTY_ARR = []\nvar SVG_NS = \"http://www.w3.org/2000/svg\"\n\nvar id = (a) => a\nvar map = EMPTY_ARR.map\nvar isArray = Array.isArray\nvar enqueue =\n  typeof requestAnimationFrame !== \"undefined\"\n    ? requestAnimationFrame\n    : setTimeout\n\nvar createClass = (obj) => {\n  var out = \"\"\n\n  if (typeof obj === \"string\") return obj\n\n  if (isArray(obj)) {\n    for (var k = 0, tmp; k < obj.length; k++) {\n      if ((tmp = createClass(obj[k]))) {\n        out += (out && \" \") + tmp\n      }\n    }\n  } else {\n    for (var k in obj) {\n      if (obj[k]) out += (out && \" \") + k\n    }\n  }\n\n  return out\n}\n\nvar shouldRestart = (a, b) => {\n  for (var k in { ...a, ...b }) {\n    if (typeof (isArray(a[k]) ? a[k][0] : a[k]) === \"function\") {\n      b[k] = a[k]\n    } else if (a[k] !== b[k]) return true\n  }\n}\n\nvar patchSubs = (oldSubs, newSubs = EMPTY_ARR, dispatch) => {\n  for (\n    var subs = [], i = 0, oldSub, newSub;\n    i < oldSubs.length || i < newSubs.length;\n    i++\n  ) {\n    oldSub = oldSubs[i]\n    newSub = newSubs[i]\n\n    subs.push(\n      newSub && newSub !== true\n        ? !oldSub ||\n          newSub[0] !== oldSub[0] ||\n          shouldRestart(newSub[1], oldSub[1])\n          ? [\n              newSub[0],\n              newSub[1],\n              (oldSub && oldSub[2](), newSub[0](dispatch, newSub[1])),\n            ]\n          : oldSub\n        : oldSub && oldSub[2]()\n    )\n  }\n  return subs\n}\n\nvar getKey = (vdom) => (vdom == null ? vdom : vdom.key)\n\nvar patchProperty = (node, key, oldValue, newValue, listener, isSvg) => {\n  if (key === \"key\") {\n  } else if (key === \"style\") {\n    for (var k in { ...oldValue, ...newValue }) {\n      oldValue = newValue == null || newValue[k] == null ? \"\" : newValue[k]\n      if (k[0] === \"-\") {\n        node[key].setProperty(k, oldValue)\n      } else {\n        node[key][k] = oldValue\n      }\n    }\n  } else if (key[0] === \"o\" && key[1] === \"n\") {\n    if (\n      !((node.events || (node.events = {}))[(key = key.slice(2))] = newValue)\n    ) {\n      node.removeEventListener(key, listener)\n    } else if (!oldValue) {\n      node.addEventListener(key, listener)\n    }\n  } else if (!isSvg && key !== \"list\" && key !== \"form\" && key in node) {\n    node[key] = newValue == null ? \"\" : newValue\n  } else if (\n    newValue == null ||\n    newValue === false ||\n    (key === \"class\" && !(newValue = createClass(newValue)))\n  ) {\n    node.removeAttribute(key)\n  } else {\n    node.setAttribute(key, newValue)\n  }\n}\n\nvar createNode = (vdom, listener, isSvg) => {\n  var props = vdom.props\n  var node =\n    vdom.type === TEXT_NODE\n      ? document.createTextNode(vdom.tag)\n      : (isSvg = isSvg || vdom.tag === \"svg\")\n      ? document.createElementNS(SVG_NS, vdom.tag, { is: props.is })\n      : document.createElement(vdom.tag, { is: props.is })\n\n  for (var k in props) {\n    patchProperty(node, k, null, props[k], listener, isSvg)\n  }\n\n  for (var i = 0; i < vdom.children.length; i++) {\n    node.appendChild(\n      createNode(\n        (vdom.children[i] = maybeVNode(vdom.children[i])),\n        listener,\n        isSvg\n      )\n    )\n  }\n\n  return (vdom.node = node)\n}\n\nvar patch = (parent, node, oldVNode, newVNode, listener, isSvg) => {\n  if (oldVNode === newVNode) {\n  } else if (\n    oldVNode != null &&\n    oldVNode.type === TEXT_NODE &&\n    newVNode.type === TEXT_NODE\n  ) {\n    if (oldVNode.tag !== newVNode.tag) node.nodeValue = newVNode.tag\n  } else if (oldVNode == null || oldVNode.tag !== newVNode.tag) {\n    node = parent.insertBefore(\n      createNode((newVNode = maybeVNode(newVNode)), listener, isSvg),\n      node\n    )\n    if (oldVNode != null) {\n      parent.removeChild(oldVNode.node)\n    }\n  } else {\n    var tmpVKid\n    var oldVKid\n\n    var oldKey\n    var newKey\n\n    var oldProps = oldVNode.props\n    var newProps = newVNode.props\n\n    var oldVKids = oldVNode.children\n    var newVKids = newVNode.children\n\n    var oldHead = 0\n    var newHead = 0\n    var oldTail = oldVKids.length - 1\n    var newTail = newVKids.length - 1\n\n    isSvg = isSvg || newVNode.tag === \"svg\"\n\n    for (var i in { ...oldProps, ...newProps }) {\n      if (\n        (i === \"value\" || i === \"selected\" || i === \"checked\"\n          ? node[i]\n          : oldProps[i]) !== newProps[i]\n      ) {\n        patchProperty(node, i, oldProps[i], newProps[i], listener, isSvg)\n      }\n    }\n\n    while (newHead <= newTail && oldHead <= oldTail) {\n      if (\n        (oldKey = getKey(oldVKids[oldHead])) == null ||\n        oldKey !== getKey(newVKids[newHead])\n      ) {\n        break\n      }\n\n      patch(\n        node,\n        oldVKids[oldHead].node,\n        oldVKids[oldHead],\n        (newVKids[newHead] = maybeVNode(\n          newVKids[newHead++],\n          oldVKids[oldHead++]\n        )),\n        listener,\n        isSvg\n      )\n    }\n\n    while (newHead <= newTail && oldHead <= oldTail) {\n      if (\n        (oldKey = getKey(oldVKids[oldTail])) == null ||\n        oldKey !== getKey(newVKids[newTail])\n      ) {\n        break\n      }\n\n      patch(\n        node,\n        oldVKids[oldTail].node,\n        oldVKids[oldTail],\n        (newVKids[newTail] = maybeVNode(\n          newVKids[newTail--],\n          oldVKids[oldTail--]\n        )),\n        listener,\n        isSvg\n      )\n    }\n\n    if (oldHead > oldTail) {\n      while (newHead <= newTail) {\n        node.insertBefore(\n          createNode(\n            (newVKids[newHead] = maybeVNode(newVKids[newHead++])),\n            listener,\n            isSvg\n          ),\n          (oldVKid = oldVKids[oldHead]) && oldVKid.node\n        )\n      }\n    } else if (newHead > newTail) {\n      while (oldHead <= oldTail) {\n        node.removeChild(oldVKids[oldHead++].node)\n      }\n    } else {\n      for (var keyed = {}, newKeyed = {}, i = oldHead; i <= oldTail; i++) {\n        if ((oldKey = oldVKids[i].key) != null) {\n          keyed[oldKey] = oldVKids[i]\n        }\n      }\n\n      while (newHead <= newTail) {\n        oldKey = getKey((oldVKid = oldVKids[oldHead]))\n        newKey = getKey(\n          (newVKids[newHead] = maybeVNode(newVKids[newHead], oldVKid))\n        )\n\n        if (\n          newKeyed[oldKey] ||\n          (newKey != null && newKey === getKey(oldVKids[oldHead + 1]))\n        ) {\n          if (oldKey == null) {\n            node.removeChild(oldVKid.node)\n          }\n          oldHead++\n          continue\n        }\n\n        if (newKey == null || oldVNode.type === SSR_NODE) {\n          if (oldKey == null) {\n            patch(\n              node,\n              oldVKid && oldVKid.node,\n              oldVKid,\n              newVKids[newHead],\n              listener,\n              isSvg\n            )\n            newHead++\n          }\n          oldHead++\n        } else {\n          if (oldKey === newKey) {\n            patch(\n              node,\n              oldVKid.node,\n              oldVKid,\n              newVKids[newHead],\n              listener,\n              isSvg\n            )\n            newKeyed[newKey] = true\n            oldHead++\n          } else {\n            if ((tmpVKid = keyed[newKey]) != null) {\n              patch(\n                node,\n                node.insertBefore(tmpVKid.node, oldVKid && oldVKid.node),\n                tmpVKid,\n                newVKids[newHead],\n                listener,\n                isSvg\n              )\n              newKeyed[newKey] = true\n            } else {\n              patch(\n                node,\n                oldVKid && oldVKid.node,\n                null,\n                newVKids[newHead],\n                listener,\n                isSvg\n              )\n            }\n          }\n          newHead++\n        }\n      }\n\n      while (oldHead <= oldTail) {\n        if (getKey((oldVKid = oldVKids[oldHead++])) == null) {\n          node.removeChild(oldVKid.node)\n        }\n      }\n\n      for (var i in keyed) {\n        if (newKeyed[i] == null) {\n          node.removeChild(keyed[i].node)\n        }\n      }\n    }\n  }\n\n  return (newVNode.node = node)\n}\n\nvar propsChanged = (a, b) => {\n  for (var k in a) if (a[k] !== b[k]) return true\n  for (var k in b) if (a[k] !== b[k]) return true\n}\n\nvar maybeVNode = (newVNode, oldVNode) =>\n  newVNode !== true && newVNode !== false && newVNode\n    ? typeof newVNode.tag === \"function\"\n      ? ((!oldVNode ||\n          oldVNode.memo == null ||\n          propsChanged(oldVNode.memo, newVNode.memo)) &&\n          ((oldVNode = newVNode.tag(newVNode.memo)).memo = newVNode.memo),\n        oldVNode)\n      : newVNode\n    : text(\"\")\n\nvar recycleNode = (node) =>\n  node.nodeType === TEXT_NODE\n    ? text(node.nodeValue, node)\n    : createVNode(\n        node.nodeName.toLowerCase(),\n        EMPTY_OBJ,\n        map.call(node.childNodes, recycleNode),\n        SSR_NODE,\n        node\n      )\n\nvar createVNode = (tag, props, children, type, node) => ({\n  tag,\n  props,\n  key: props.key,\n  children,\n  type,\n  node,\n})\n\nexport var memo = (tag, memo) => ({ tag, memo })\n\nexport var text = (value, node) =>\n  createVNode(value, EMPTY_OBJ, EMPTY_ARR, TEXT_NODE, node)\n\nexport var h = (tag, props, children = EMPTY_ARR) =>\n  createVNode(tag, props, isArray(children) ? children : [children])\n\nexport var app = ({\n  node,\n  view,\n  subscriptions,\n  dispatch = id,\n  init = EMPTY_OBJ,\n}) => {\n  var vdom = node && recycleNode(node)\n  var subs = []\n  var state\n  var busy\n\n  var update = (newState) => {\n    if (state !== newState) {\n      if ((state = newState) == null) dispatch = subscriptions = render = id\n      if (subscriptions) subs = patchSubs(subs, subscriptions(state), dispatch)\n      if (view && !busy) enqueue(render, (busy = true))\n    }\n  }\n\n  var render = () =>\n    (node = patch(\n      node.parentNode,\n      node,\n      vdom,\n      (vdom = view(state)),\n      listener,\n      (busy = false)\n    ))\n\n  var listener = function (event) {\n    dispatch(this.events[event.type], event)\n  }\n\n  return (\n    (dispatch = dispatch((action, props) =>\n      typeof action === \"function\"\n        ? dispatch(action(state, props))\n        : isArray(action)\n        ? typeof action[0] === \"function\"\n          ? dispatch(action[0], action[1])\n          : action\n              .slice(1)\n              .map(\n                (fx) => fx && fx !== true && fx[0](dispatch, fx[1]),\n                update(action[0])\n              )\n        : update(action)\n    ))(init),\n    dispatch\n  )\n}\n","/**\n * Represents a Camera used to take still photos and also exposes a Video elemetn that can be used to show a preview to the user.\n *\n * The overall flow of taking a photo is:\n *   1. Use getUserMedia to get a stream from the user's camera\n *   2. Create an HTML video element and set the source of the video element to the stream\n *      This video element can also be added to the document to show a preview to the user\n *   3. When a photo should be taken draw the current video frame from the video element to\n *      a canvas and convert the canvas to a a DataURL\n *\n *\n * There are a few complications that this class also adresses.\n * Of particular interest is that on some platforms the video element used is not allowed to\n * play as those platforms block autoplay. In such cases the isPlaying function will return false\n * and a message should be shown to the user. With the user action the forcePlay function can then\n * be called to allow the video to play.\n */\nexport function PhotoCamera() {\n  const player = document.createElement(\"video\");\n  const canvas = document.createElement(\"canvas\");\n  const ctx = canvas.getContext(\"2d\");\n  let playing = false;\n\n  player.playsInline = true; //Needed to show to viewfinder on iOS\n\n  navigator.mediaDevices\n    .getUserMedia({\n      video: { facingMode: \"environment\" },\n    })\n    .then((stream) => {\n      player.srcObject = stream;\n      forcePlay();\n    })\n    .catch((err) => console.error(\"An error occurred while getting the camera stream:\", err));\n\n  player.addEventListener(\"canplay\", adjustSize);\n  window.addEventListener(\"resize\", adjustSize);\n\n  function adjustSize(): void {\n    canvas.width = player.videoWidth;\n    canvas.height = player.videoHeight;\n  }\n\n  /**\n   * Takes a photo\n   */\n  function snap(): string {\n    adjustSize();\n    ctx.drawImage(player, 0, 0, canvas.width, canvas.height);\n    return canvas.toDataURL(\"image/png\");\n  }\n\n  function getVideoElement(): HTMLVideoElement {\n    return player;\n  }\n\n  function forcePlay(): Promise<any> {\n    return player\n      .play()\n      .catch((e) => {\n        console.log(\"error while playing video\", e);\n        playing = false;\n        return e;\n      })\n      .then((e) => {\n        console.log(\"Play video was successufull\", e);\n        playing = true;\n        return e;\n      });\n  }\n\n  return {\n    snap,\n    getVideoElement,\n    forcePlay,\n    isPlaying: () => playing,\n  };\n}\n\nexport function fetchArrayBuffer(url: string): Promise<ArrayBuffer> {\n  return fetch(url).then((response) => response.arrayBuffer());\n}\n\nexport function fetchAudio(url: string, ctx: AudioContext) {\n  return fetchArrayBuffer(url).then((buffer) => ctx.decodeAudioData(buffer));\n}\n\ndelete window.AudioContext;\n\nexport class AudioPlayer {\n  readonly disabled: boolean;\n  private audioContext: AudioContext;\n  private cache: Map<string, AudioBuffer>;\n\n  constructor() {\n    this.disabled = !(\"AudioContext\" in window);\n    if (!this.disabled) {\n      this.audioContext = new AudioContext();\n      this.cache = new Map();\n    } else {\n      console.warn(\"This device does not support AudioContext. Audio playback was disabled.\");\n    }\n  }\n\n  async load(url: string): Promise<AudioBuffer | Error> {\n    if (this.disabled) {\n      return new Error(\"AudioContext not supported\");\n    }\n    const result = await fetchAudio(url, this.audioContext);\n    this.cache.set(url, result);\n    return result;\n  }\n\n  /// Returns the audio buffer at that url or an empty buffer if it is not loaded yet\n  private get(url: string) {\n    if (this.cache.has(url)) {\n      return this.cache.get(url);\n    }\n    this.load(url);\n    console.warn(\"[AudioPlayer] tried to play non-loaded sound\");\n    return this.audioContext.createBuffer(2, 22050, 44100);\n  }\n\n  private getAudioBufferSourceNode(url: string): AudioBufferSourceNode {\n    const source = this.audioContext.createBufferSource();\n    source.buffer = this.get(url);\n    source.connect(this.audioContext.destination);\n    return source;\n  }\n\n  play(url: string): AudioBufferSourceNode | Error {\n    if (this.disabled) {\n      return new Error(\"AudioContext not supported\");\n    }\n    const source = this.getAudioBufferSourceNode(url);\n    source.start(0);\n    return source;\n  }\n\n  loop(url: string): AudioBufferSourceNode | Error {\n    if (this.disabled) {\n      return new Error(\"AudioContext not supported\");\n    }\n    const source = this.getAudioBufferSourceNode(url);\n    source.loop = true;\n    source.start(0);\n    return source;\n  }\n}\n\nexport const globalAudioPlayer = new AudioPlayer();\n","export function indexIntoObject(path: string[], root: any): any {\n  let obj = root;\n  for (let el of path) {\n    obj = obj[el];\n  }\n  return obj;\n}\n\nexport function jsonclone(obj) {\n  return JSON.parse(JSON.stringify(obj));\n}\n\nexport function repeat<T>(count: number, value: T): T[] {\n  return Array(count).fill(value);\n}\n\nexport function download(href: string, name = \"img.png\"): void {\n  const a = document.createElement(\"a\");\n  a.href = href;\n  a.download = name;\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n}\n\nfunction toBinary(string: string): string {\n  const codeUnits = new Uint16Array(string.length);\n  for (let i = 0; i < codeUnits.length; i++) {\n    codeUnits[i] = string.charCodeAt(i);\n  }\n  return String.fromCharCode(...new Uint8Array(codeUnits.buffer));\n}\n\nfunction arrayBufferToBase64(arrayBuffer: ArrayBuffer): string {\n  const decoder = new TextDecoder(\"utf8\");\n  const decoded = decoder.decode(arrayBuffer);\n  const binaryString = toBinary(decoded);\n  return btoa(binaryString);\n}\n\nexport function hashPhoto(photo: string): Promise<string> {\n  const enc = new TextEncoder();\n  const array = enc.encode(photo);\n  return crypto.subtle.digest(\"SHA-1\", array).then(arrayBufferToBase64);\n}\n\nexport function photoFileName(photo: string): Promise<string> {\n  return hashPhoto(photo).then(\n    (hash) => hash.replace(/_/g, \"\").replace(/\\//g, \"\").substring(3, 13) + \".png\"\n  );\n}\n\n/**\n * Converts the given photo dataurl to a File object\n */\nexport async function photoToFile(photo: string): Promise<File> {\n  const res = await fetch(photo);\n  const buffer = await res.arrayBuffer();\n  const hash = await crypto.subtle.digest(\"SHA-1\", buffer);\n  const hashString = arrayBufferToBase64(hash);\n  const fileName = hashString.replace(/_/g, \"\").replace(/\\//g, \"\").substring(3, 13) + \".png\";\n\n  const file = new File([buffer], fileName, {\n    type: \"image/png\",\n  });\n  return file;\n}\n\nexport async function shareDownload(photos: string[]) {\n  if (!(\"share\" in window.navigator)) {\n    //TODO: polyfill this?\n    return Promise.resolve(new Error(\"navigator.share not supported\"));\n  }\n\n  const files = await Promise.all(photos.map(photoToFile));\n  const shareData = { files } as ShareData;\n  return await navigator.share(shareData);\n}\n","function getLangaugePreferences(): string[] {\n  const languages = [];\n\n  const languageOverride = window.localStorage.languageOverride;\n  if (languageOverride) {\n    languages.push(languageOverride);\n    languages.push(languageOverride.split(\"-\")[0]);\n  }\n\n  languages.push(window.navigator.language);\n  languages.push(window.navigator.language.split(\"-\")[0]);\n  languages.push(\"en\");\n\n  return languages;\n}\n\nconst languagePrefs = getLangaugePreferences();\n\nconsole.log({ languagePrefs });\n\nfunction selectL(desc: { [key: string]: () => string }): string {\n  for (const lang of languagePrefs) {\n    let selection = desc[lang];\n    if (selection) {\n      return selection();\n    }\n  }\n  console.error(\"Missing translation!\");\n  return \"???\";\n}\n\nconst c = (cond: boolean, text: string) => (cond ? text : \"\");\n\nexport const deleteDatabaseConfirmation = (): string =>\n  selectL({\n    de: () => \"Sind Sie sicher, dass Sie alle Daten löschen wollen?\",\n    en: () => \"Are you sure you want to delete all data?\",\n  });\n\nexport const gallery = (): string =>\n  selectL({\n    de: () => \"Galerie\",\n    en: () => \"Gallery\",\n  });\n\nexport const shop = (): string =>\n  selectL({\n    de: () => \"Fotoladen\",\n    en: () => \"Shop\",\n  });\n\nexport const readyForPickup = (): string =>\n  selectL({\n    de: () => \"Abhohlbereit!\",\n    en: () => \"Ready for pickup!\",\n  });\n\nexport const back = (): string =>\n  selectL({\n    de: () => \"Zurück\",\n    en: () => \"Back\",\n  });\n\nexport const downloadAll = (): string =>\n  selectL({\n    de: () => \"Herunterladen\",\n    en: () => \"Download\",\n  });\n\nexport const instantDevelopmentMode = (): string =>\n  selectL({\n    de: () => \"Sofortbildmodus\",\n    en: () => \"Instant camera mode\",\n  });\n\nexport const pleaseAllowVideoPlayback = (): string =>\n  selectL({\n    de: () => \"Hey, bitte dücke diesen Knopf um der App zu erlauben Video darzustellen.\",\n    en: () => \"Hey, please press this button to allow the app to show you video.\",\n  });\n\nexport const allow = (): string =>\n  selectL({\n    de: () => \"Erlauben\",\n    en: () => \"Allow\",\n  });\n\nexport const nrOfFilmsInLab = (count: number): string => {\n  const single = count === 1;\n  return selectL({\n    de: () =>\n      `Momentan ${single ? \"ist\" : \"sind\"} ${count} Film${c(!single, \"e\")} in der Dunkelkammer`,\n    en: () => `There ${single ? \"is\" : \"are\"} currently ${count} film${c(!single, \"s\")} in the lab`,\n  });\n};\n\nconst day = (): string =>\n  selectL({\n    de: () => \"Tag\",\n    en: () => \"day\",\n  });\n\nconst days = (): string =>\n  selectL({\n    de: () => \"Tagen\",\n    en: () => \"days\",\n  });\n\nconst hour = (): string =>\n  selectL({\n    de: () => \"Stunde\",\n    en: () => \"hour\",\n  });\n\nconst hours = (): string =>\n  selectL({\n    de: () => \"Stunden\",\n    en: () => \"hours\",\n  });\n\nconst minute = (): string =>\n  selectL({\n    de: () => \"Minute\",\n    en: () => \"minute\",\n  });\n\nconst minutes = (): string =>\n  selectL({\n    de: () => \"Minuten\",\n    en: () => \"minutes\",\n  });\n\nexport function timeFormat(time: number): string {\n  const timeInSeconds = time / 1000;\n  const timeInMinutes = timeInSeconds / 60;\n  const timeInHours = timeInMinutes / 60;\n  const timeInDays = timeInHours / 24;\n\n  if (timeInDays > 1) {\n    const res = Math.round(timeInDays);\n    return res + \" \" + (res === 1 ? day() : days());\n  }\n\n  if (timeInHours > 1) {\n    const res = Math.round(timeInHours);\n    return res + \" \" + (res === 1 ? hour() : hours());\n  }\n\n  if (timeInMinutes > 1) {\n    const res = Math.round(timeInMinutes);\n    return res + \" \" + (res === 1 ? minute() : minutes());\n  }\n\n  return selectL({\n    de: () => \"weniger als einer Minute\",\n    en: () => \"under a minute\",\n  });\n}\n\nexport const filmReadyIn = (time: number): string =>\n  selectL({\n    de: () => `Abholbereit in ${timeFormat(time)}`,\n    en: () => `The film will be ready in ${timeFormat(time)}`,\n  });\n","export const CLICK_SOUND_FILE = \"./assets/click.flac\";\n","import { PhotoCamera } from \"./media\";\n\nexport const camera = PhotoCamera();\n\nconst SHUTTER_SPEED = 0.15;\nconst CLOSED_SHUTTER_TIME = 0.2;\nconst leftShutter = creatShutter();\nleftShutter.style.left = \"0\";\nconst rightShutter = creatShutter();\nrightShutter.style.right = \"0\";\n\nfunction creatShutter() {\n  const shutter = document.createElement(\"div\");\n  shutter.style.height = \"100%\";\n  shutter.style.width = \"0px\";\n  shutter.style.background = \"black\";\n  shutter.style.position = \"absolute\";\n  shutter.style.top = \"0\";\n  shutter.style.transition = SHUTTER_SPEED + \"s\";\n  return shutter;\n}\n\nexport function closeAndOpenShutter() {\n  leftShutter.style.width = \"50px\";\n  rightShutter.style.width = \"50px\";\n  setTimeout(() => {\n    leftShutter.style.width = \"0\";\n    rightShutter.style.width = \"0\";\n  }, (SHUTTER_SPEED + CLOSED_SHUTTER_TIME) * 1000);\n}\n\nfunction adjustViewfinderPosition() {\n  const viewfinder = document.getElementById(\"viewfinder\");\n  const videoWidth = parseInt(\n    window.getComputedStyle(document.querySelector(\"#viewfinder video\")).width,\n    10\n  );\n  viewfinder.style.left = (document.documentElement.clientWidth - videoWidth) / 2 + \"px\";\n}\n\nfunction injectViewfinder() {\n  const viewfinder = document.getElementById(\"viewfinder\");\n  const videoElement = camera.getVideoElement();\n  console.log(\"adding video player\");\n  videoElement.style.width = \"100px\";\n  viewfinder.appendChild(leftShutter);\n  viewfinder.appendChild(videoElement);\n  viewfinder.appendChild(rightShutter);\n  adjustViewfinderPosition();\n\n  window.addEventListener(\"resize\", function () {\n    adjustViewfinderPosition();\n  });\n}\n\n// Tries to inject the viewfinder and returns true on success false otherwise\nfunction tryToInjectViewfinder() {\n  const viewfinder = document.getElementById(\"viewfinder\");\n  if (viewfinder) {\n    injectViewfinder();\n    console.log(\"Successfully injected viewfinder\");\n    return true;\n  } else {\n    console.log(\"failed to inject viewfinder\");\n    return false;\n  }\n}\n\nfunction updateVhCssVariable() {\n  const vh = window.innerHeight * 0.01;\n  document.documentElement.style.setProperty(\"--vh\", vh + \"px\");\n}\n\nexport function executeManualDOMTasks() {\n  //Try to inject the viewfinder till it works\n  camera.getVideoElement().addEventListener(\"canplay\", () => {\n    const viewfinderTryHandle = setInterval(() => {\n      if (tryToInjectViewfinder()) {\n        clearInterval(viewfinderTryHandle);\n      }\n    }, 300);\n  });\n\n  //Update the --vh css variable\n  window.addEventListener(\"resize\", updateVhCssVariable);\n  updateVhCssVariable();\n}\n","import { Film, Photo } from \"./persistence\";\n\nexport type State = {\n  activeFilm: Film;\n  filmsInDevelopment: Film[];\n  galleryImages: Photo[];\n  path: Path;\n  currentTime: number;\n  zeroDevelopmentTime: boolean;\n  showVideoPermissionPopup: boolean;\n  galleryDownloadInProgress: boolean;\n};\n\nexport enum Path {\n  Camera = \"@#camera\",\n  Shop = \"@#shop\",\n  Gallery = \"@#gallery\",\n}\n","import { globalAudioPlayer } from \"./media\";\nimport { db, Film, Photo } from \"./persistence\";\nimport { download, photoFileName, shareDownload } from \"./utils\";\nimport * as translator from \"./translator\";\nimport { CLICK_SOUND_FILE } from \"./constants\";\nimport { camera, closeAndOpenShutter } from \"./dom\";\nimport { Path, State } from \"./types.js\";\nimport { Dispatchable } from \"hyperapp\";\n\nexport const AskForVideoPermission = (state: State): Dispatchable<State> => ({\n  ...state,\n  showVideoPermissionPopup: true,\n});\n\nexport const GotVideoPermission = (state: State): Dispatchable<State> => [\n  { ...state, showVideoPermissionPopup: false },\n  [\n    () => {\n      camera.forcePlay();\n    },\n  ],\n];\n\nexport const TakePhoto = (state: State): Dispatchable<State> => [\n  state,\n  [\n    (dispatch) => {\n      if (!camera.isPlaying()) {\n        dispatch(AskForVideoPermission);\n        return;\n      }\n\n      const pic = camera.snap();\n      closeAndOpenShutter();\n      globalAudioPlayer.play(CLICK_SOUND_FILE);\n      db.addPhotoToActiveFilm(pic).then((film) => {\n        dispatch(NewPhotoTaken, film);\n      });\n    },\n  ],\n];\n\nexport const DownloadPhoto = (state: State, photo: Photo): Dispatchable<State> => [\n  state,\n  [\n    () => {\n      photoFileName(photo).then((name) => {\n        download(photo, name);\n      });\n    },\n  ],\n];\n\nexport const FilmsInDevelopmentChanged = (\n  state: State,\n  filmsInDevelopment: Film[]\n): Dispatchable<State> => {\n  return {\n    ...state,\n    filmsInDevelopment,\n  };\n};\n\nexport const ResetDb = (state: State): Dispatchable<State> => [\n  state,\n  [\n    () => {\n      if (window.confirm(translator.deleteDatabaseConfirmation())) {\n        db.deleteDatabase();\n        window.location.reload();\n      }\n    },\n  ],\n];\n\nexport const NewFilmWasInserted = (state: State, newFilm: Film): Dispatchable<State> => ({\n  ...state,\n  activeFilm: newFilm,\n});\n\nexport const UpdateTime = (state: State): Dispatchable<State> => ({\n  ...state,\n  currentTime: Date.now(),\n});\n\nexport const ChangeZeroDevelopmentMode = (state: State, event: any): Dispatchable<State> => ({\n  ...state,\n  zeroDevelopmentTime: event.target.checked,\n});\n\nexport const NewPhotoTaken = (state: State, film: Film): Dispatchable<State> => [\n  {\n    ...state,\n    activeFilm: film,\n  },\n  film.photos.length >= film.frames && [\n    (dispatch) => {\n      db.addFilm().then((newFilmId) => {\n        Promise.all([db.setActiveFilmId(newFilmId), db.loadFilm(newFilmId)]).then(([, newFilm]) => {\n          dispatch(NewFilmWasInserted, newFilm);\n          db.addDevelopmentStartTimeStampToFilm(film.id, Date.now()).then(() =>\n            db.loadAllFilmsInDevelopment().then((films) => {\n              dispatch(FilmsInDevelopmentChanged, films);\n            })\n          );\n        });\n      });\n    },\n  ],\n];\n\nexport const DevelopedFilmWasCollected = (state: State, filmId: number): Dispatchable<State> => [\n  {\n    ...state,\n  },\n  [\n    (dispatch) => {\n      db.developFilm(filmId).then((developedFilm) => {\n        db.loadAllFilmsInDevelopment().then((films) => {\n          dispatch(FilmsInDevelopmentChanged, films);\n        });\n        Promise.all(developedFilm.photos.map((photoId) => db.loadPhoto(photoId))).then((photos) =>\n          dispatch(EnterGallery, photos)\n        );\n      });\n    },\n  ],\n];\n\nexport const EnterGallery = (state: State, galleryImages: Photo[]): Dispatchable<State> => ({\n  ...state,\n  path: Path.Gallery,\n  galleryImages,\n});\n\nexport const ExitGallery = (state: State): Dispatchable<State> => ({\n  ...state,\n  path: Path.Camera,\n});\n\nexport const AddPhotoToGallery = (state: State, { photo, index }): Dispatchable<State> => {\n  let newGalleryImages = [...state.galleryImages];\n  newGalleryImages[index] = photo;\n  return { ...state, galleryImages: newGalleryImages };\n};\n\nexport const EnterShop = (state: State): Dispatchable<State> => ({\n  ...state,\n  path: Path.Shop,\n});\n\nexport const ExitShop = (state: State): Dispatchable<State> => ({\n  ...state,\n  path: Path.Camera,\n});\n\nexport const EnterMainGallery = (state: State): Dispatchable<State> => [\n  { ...state },\n  [\n    (dispatch) => {\n      db.loadDevelopedPhotoIds().then((photoIds) => {\n        dispatch(EnterGallery, new Array(photoIds.length));\n        photoIds.forEach((photoId, index) => {\n          db.loadPhoto(photoId).then((photo) => dispatch(AddPhotoToGallery, { index, photo }));\n        });\n      });\n    },\n  ],\n];\n\nexport const DownloadGalleryDone = (state: State): Dispatchable<State> => ({\n  ...state,\n  galleryDownloadInProgress: false,\n});\n\nexport const StartDownloadGallery = (state: State): Dispatchable<State> => [\n  { ...state, galleryDownloadInProgress: true },\n  [\n    (dispatch) => {\n      db.loadAllDevelopedPhotos().then((photos) => {\n        shareDownload(photos).then(() => dispatch(DownloadGalleryDone));\n      });\n    },\n  ],\n];\n","import { h, StyleProp, text, VNode } from \"hyperapp\";\nimport {\n  DevelopedFilmWasCollected,\n  ExitGallery,\n  DownloadPhoto,\n  ExitShop,\n  EnterMainGallery,\n  TakePhoto,\n  ResetDb,\n  EnterShop,\n  ChangeZeroDevelopmentMode,\n  GotVideoPermission,\n  AskForVideoPermission,\n  StartDownloadGallery,\n} from \"./actions\";\nimport { Film, Photo } from \"./persistence\";\nimport * as translator from \"./translator\";\nimport { Path, State } from \"./types\";\n\nconst SECONDS = 1000;\nconst MINUTES = 60 * SECONDS;\nconst HOURS = 60 * MINUTES;\n\nconst DEVELOPMENT_TIME = 0.5 * HOURS;\n\nexport const rootComponent = (state: State): VNode<State> =>\n  h(\"main\", { style: { overflow: \"hidden\" } }, [\n    h(\n      \"div\",\n      {\n        class: \"camera-and-shop\",\n        style: {\n          marginTop: state.path === Path.Gallery ? \"calc(var(--vh, 1vh) * -100)\" : \"0\",\n          marginLeft: state.path === Path.Shop ? \"-100vw\" : \"0\",\n          position: \"relative\",\n        },\n      },\n      [\n        h(\"div\", {\n          id: \"viewfinder\",\n          style: {\n            position: \"absolute\",\n            top: \"0\",\n          },\n        }),\n        camera(state),\n        shop(state),\n      ]\n    ),\n    gallery(state),\n    videoPermissionPopup(state.showVideoPermissionPopup),\n  ]);\n\nexport const camera = (state: State): VNode<State> =>\n  h(\"div\", { class: \"camera\" }, [\n    h(\n      \"div\",\n      {\n        class: \"camera__top-panel\",\n      },\n      [filmIndicator(state), h(\"button\", { onclick: TakePhoto, class: \"snap-button\" })]\n    ),\n    h(\"div\", { class: \"camera__bottom-panel\" }, [\n      h(\"div\", { class: \"camera__info-area\" }, [filmLab(state)]),\n\n      h(\"div\", { class: \"camera__button-bar\" }, [\n        h(\"button\", { class: \"p-button\", onclick: EnterMainGallery }, [text(translator.gallery())]),\n        h(\"button\", { class: \"p-button\", onclick: EnterShop }, [text(translator.shop())]),\n        h(\"button\", { class: \"p-button\", onclick: ResetDb }, [text(\"RESET\")]),\n      ]),\n    ]),\n  ]);\n\nexport const filmIndicator = ({ activeFilm }): VNode<any> =>\n  h(\"div\", { class: \"film-state\" }, [\n    ...Array.from({ length: activeFilm.photos.length }, () =>\n      h(\"div\", { class: \"photo-in-film-used\" })\n    ),\n    ...Array.from({ length: activeFilm.frames - activeFilm.photos.length }, () =>\n      h(\"div\", { class: \"photo-in-film-free\" })\n    ),\n  ]);\n\nexport const filmLab = ({\n  filmsInDevelopment,\n  zeroDevelopmentTime,\n  currentTime,\n}: State): VNode<State> =>\n  h(\"div\", { style: { marginTop: \"1rem\" } }, [\n    text(translator.nrOfFilmsInLab(filmsInDevelopment.length)),\n    h(\n      \"ul\",\n      { style: { paddingLeft: \"1rem\", lineHeight: \"2\", marginTop: \"0.5rem\" } },\n      filmsInDevelopment.map((film) => filmLabItem(film, zeroDevelopmentTime, currentTime))\n    ),\n  ]);\n\nexport const filmLabItem = (\n  film: Film,\n  zeroDevelopmentTime: boolean,\n  currentTime: number\n): VNode<State> => {\n  const timeInDevelopment = currentTime - film.developmentStartDate;\n  const timeLeft = DEVELOPMENT_TIME - timeInDevelopment;\n  let isDone = timeLeft <= 0;\n\n  if (zeroDevelopmentTime) {\n    isDone = true;\n  }\n\n  return h(\"li\", { style: { marginBottom: \"0.3rem\" } }, [\n    isDone\n      ? h(\n          \"button\",\n          {\n            onclick: [DevelopedFilmWasCollected, film.id],\n            class: \"p-button\",\n          },\n          [text(translator.readyForPickup())]\n        )\n      : text(translator.filmReadyIn(timeLeft)),\n  ]);\n};\n\nexport const galleryImagesList = ({ galleryImages }: { galleryImages: Photo[] }): VNode<State> =>\n  h(\n    \"div\",\n    { class: \"p-card\", style: { marginBottom: \"1rem\" } },\n    galleryImages.map((photo) =>\n      h(\"img\", {\n        src: photo,\n        class: \"gallery__photo\",\n        onclick: [DownloadPhoto, photo],\n      })\n    )\n  );\n\nexport const gallery = ({ galleryImages, galleryDownloadInProgress }: State): VNode<State> =>\n  h(\"div\", { class: \"gallery\" }, [\n    h(\"div\", { class: \"p-card flex-row\", style: { alignItems: \"center\", marginBottom: \"1rem\" } }, [\n      h(\"h3\", { style: { flex: \"1\" } }, [text(translator.gallery())]),\n      h(\"button\", { class: \"p-button\", onclick: StartDownloadGallery }, [\n        text(translator.downloadAll()),\n        galleryDownloadInProgress && h(\"div\", { class: \"p-spinner\" }),\n      ]),\n      h(\"button\", { class: \"p-button\", onclick: ExitGallery }, [text(translator.back())]),\n    ]),\n    galleryImagesList({ galleryImages }),\n  ]);\n\nexport const shop = (state: State): VNode<State> =>\n  h(\"div\", { class: \"shop flex-column\" }, [\n    h(\"h1\", {}, [text(translator.shop())]),\n    h(\"div\", { style: { flex: \"1\" } }, [\n      h(\"label\", { style: { display: \"flex\" } }, [\n        text(translator.instantDevelopmentMode()),\n        h(\"input\", {\n          style: { marginLeft: \"1rem\" },\n          type: \"checkbox\",\n          checked: state.zeroDevelopmentTime,\n          onchange: ChangeZeroDevelopmentMode,\n        }),\n      ]),\n      debugView(state),\n      h(\"button\", { onclick: AskForVideoPermission, class: \"p-button\" }, [text(\"popuptest\")]),\n    ]),\n    h(\"button\", { onclick: ExitShop, class: \"p-button\" }, [text(translator.back())]),\n  ]);\n\nexport const debugView = ({\n  filmsInDevelopment,\n  activeFilm,\n}: {\n  filmsInDevelopment: Film[];\n  activeFilm: Film;\n}): VNode<State> =>\n  h(\n    \"details\",\n    {\n      class: \"p-card\",\n      style: { margin: \"1rem 0\" },\n    },\n    [\n      h(\n        \"summary\",\n        {\n          style: {\n            fontWeight: \"bold\",\n          },\n        },\n        [text(\"Debug\")]\n      ),\n      h(\"pre\", {}, [text(JSON.stringify({ filmsInDevelopment, activeFilm }, null, 2))]),\n    ]\n  );\n\nexport const videoPermissionPopup = (showVideoPermissionPopup: boolean): VNode<State> =>\n  h(\n    \"div\",\n    {\n      class: \"flex-column\",\n      style: {\n        position: \"absolute\",\n        top: \"0\",\n        left: \"0\",\n        width: \"100vw\",\n        height: \"calc(var(--vh, 1vh) * 100)\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        background: showVideoPermissionPopup ? \"rgba(0.3,0.3,0.3,0.6)\" : \"transparent\",\n        transition: \"0.3s\",\n        pointerEvents: showVideoPermissionPopup ? \"auto\" : \"none\",\n      },\n    },\n    [\n      h(\n        \"div\",\n        {\n          class: \"p-card flex-column\",\n          style: {\n            padding: \"2rem\",\n            marginTop: showVideoPermissionPopup ? \"0\" : \"-200vh\",\n            transform: \"scale(\" + (showVideoPermissionPopup ? \"1\" : \"0.3\") + \")\",\n            \"--movingTime\": \"0.3s\",\n            \"--transformingTime\": \"0.1s\",\n            transition: showVideoPermissionPopup\n              ? \"margin var(--movingTime) 0s, transform var(--transformingTime) var(--movingTime)\"\n              : \"margin var(--movingTime) var(--transformingTime), transform var(--transformingTime) 0s\",\n          } as StyleProp,\n        },\n        [\n          h(\"p\", { style: { paddingBottom: \"2rem\" } }, [\n            text(translator.pleaseAllowVideoPlayback()),\n          ]),\n          h(\"button\", { class: \"p-button primary\", onclick: GotVideoPermission }, [\n            text(translator.allow()),\n          ]),\n        ]\n      ),\n    ]\n  );\n","import { initdb, db, Film } from \"./persistence\";\nimport { Action, app, Dispatch, Dispatchable, Subscription } from \"hyperapp\";\nimport { rootComponent } from \"./components\";\nimport { UpdateTime } from \"./actions\";\nimport { CLICK_SOUND_FILE } from \"./constants\";\nimport { globalAudioPlayer } from \"./media\";\nimport { executeManualDOMTasks } from \"./dom\";\nimport { Path, State } from \"./types\";\n\nexecuteManualDOMTasks();\n\ntype IntervalPayload = {\n  time: number;\n  action: Action<State>;\n};\n\nconst intervalSubscriber = (dispatch: Dispatch<State>, { time, action }: IntervalPayload) => {\n  let handle = setInterval(() => {\n    dispatch(action);\n  }, time);\n  return () => clearInterval(handle);\n};\n\nconst onInterval = (time: number, action: Action<State>): Subscription<State, IntervalPayload> => [\n  intervalSubscriber,\n  { time, action },\n];\n\nasync function initApp() {\n  await initdb();\n\n  const [initialActiveFilm, initialFilmsInDevelopment]: [Film, Film[], any] = await Promise.all([\n    db.loadActiveFilm(),\n    db.loadAllFilmsInDevelopment(),\n    globalAudioPlayer.load(CLICK_SOUND_FILE),\n  ]);\n\n  app<State>({\n    init: {\n      activeFilm: initialActiveFilm,\n      filmsInDevelopment: initialFilmsInDevelopment,\n      galleryImages: [],\n      path: Path.Camera,\n      currentTime: Date.now(),\n      zeroDevelopmentTime: false,\n      showVideoPermissionPopup: false,\n      galleryDownloadInProgress: false,\n    },\n    view: (state) => {\n      console.log(\"State before render is\", state);\n      return rootComponent(state);\n    },\n    node: document.getElementById(\"container\"),\n    subscriptions: (state) => [state.path === Path.Camera && onInterval(10000, UpdateTime)],\n  });\n}\n\ninitApp();\n"],"names":[],"mappings":"AAAA,EAMG,AANH;;;;;;CAMG,AANH,EAMG,UACM,aAAa,CAAI,CAAgB;eAC7B,OAAO,EAAE,OAAO;QACzB,CAAC,CAAC,SAAS,IAAI,CAAC,GAAK,OAAO,CAAE,CAAC,CAAC,MAAM,CAAS,MAAM;;;;MAanD,OAAO,IAAG,aAAe;MACzB,WAAW,IAAG,MAAQ;MACtB,UAAU,IAAG,KAAO;MACpB,YAAY,IAAG,MAAQ;MAEvB,sBAAsB,IAAG,cAAgB;MACzC,2BAA2B,IAAG,gBAAkB;MAEhD,OAAO;gBAGC,EAAc;cAClB,SAAS,GAAqB,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;QAEpE,SAAS,CAAC,OAAO,IAAI,KAAK,GAAK,OAAO,CAAC,KAAK,EAAC,cAAgB,GAAE,KAAK;;QACpE,SAAS,CAAC,eAAe,IAAI,KAAK;kBAC1B,GAAG,GAAiB,KAAK,CAAC,MAAM,CAAS,MAAM;YACrD,GAAG,CAAC,iBAAiB,CAAC,WAAW;gBAAI,aAAa,EAAE,IAAI;;kBAClD,UAAU,GAAG,GAAG,CAAC,iBAAiB,CAAC,UAAU;gBACjD,aAAa,EAAE,IAAI;gBACnB,OAAO,GAAE,EAAI;;kBAET,YAAY,GAAG,GAAG,CAAC,iBAAiB,CAAC,YAAY;YAEvD,EAAmD,AAAnD,iDAAmD;YACnD,UAAU,CAAC,GAAG;gBAAG,MAAM;gBAAM,MAAM,EAAE,CAAC;eAAI,SAAS,IAAI,CAAC;gBACtD,YAAY,CAAC,GAAG,CAAE,CAAC,CAAC,MAAM,CAAS,MAAM,EAAE,sBAAsB;;YAEnE,YAAY,CAAC,GAAG,KAAK,2BAA2B;YAEhD,OAAO,CAAC,GAAG,EAAC,wBAA0B;;QAGxC,SAAS,CAAC,SAAS,IAAI,KAAK;kBACpB,GAAG,GAAiB,KAAK,CAAC,MAAM,CAAS,MAAM;iBAChD,GAAG,GAAG,GAAG;YACd,GAAG,CAAC,OAAO,IAAI,MAAK,GAClB,OAAO,CAAC,KAAK,EAAC,0BAA4B,GAAG,MAAK,CAAC,MAAM,CAAS,SAAS;;YAC7E,EAAE;;;IAIN,QAAQ,CAAC,IAAY;oBACP,GAAG,CAAC,WAAW;YAAE,IAAI;YAAG,SAAW,GAAE,WAAW,CAAC,IAAI;;IAGnE,aAAa;oBACC,QAAQ,CAAC,WAAW;;IAElC,YAAY;oBACE,QAAQ,CAAC,UAAU;;IAEjC,cAAc;oBACA,QAAQ,CAAC,YAAY;;IAGnC,QAAQ,CAAC,KAAY;eACZ,aAAa,MAAM,aAAa,GAAG,GAAG,CAAC,KAAK;;IAGrD,SAAS,CAAC,EAAU;eACX,aAAa,MAAM,aAAa,GAAG,GAAG,CAAC,EAAE;;IAGlD,OAAO;eACE,aAAa,MAAM,YAAY,GAAG,GAAG;YAAG,MAAM;YAAM,MAAM,EAAE,CAAC;;;IAEtE,QAAQ,CAAC,EAAU;eACV,aAAa,MAAM,YAAY,GAAG,GAAG,CAAC,EAAE;;IAEjD,OAAO,CAAC,IAAU;eACT,aAAa,MAAM,YAAY,GAAG,GAAG,CAAC,IAAI;;IAEnD,UAAU,CAAC,EAAU;eACZ,aAAa,MAAM,YAAY,GAAG,MAAM,CAAC,EAAE;;IAEpD,YAAY;eACH,aAAa,MAAM,YAAY,GAAG,MAAM;;IAGjD,SAAS,CAAC,GAAW,EAAE,KAAU;eACxB,aAAa,MAAM,cAAc,GAAG,GAAG,CAAC,KAAK,EAAE,GAAG;;IAE3D,UAAU,CAAC,GAAW;eACb,aAAa,MAAM,cAAc,GAAG,GAAG,CAAC,GAAG;;IAEpD,eAAe,CAAC,EAAU;oBACZ,SAAS,CAAC,sBAAsB,EAAE,EAAE;;IAElD,gBAAgB;oBACF,UAAU,CAAC,sBAAsB;;UAEzC,cAAc;cACZ,MAAM,cAAc,gBAAgB;0BACxB,QAAQ,CAAC,MAAM;;IAEnC,qBAAqB;oBACP,UAAU,CAAC,2BAA2B;;UAG9C,kBAAkB,CAAC,SAAmB;YACtC,MAAM,cAAc,qBAAqB;QAC7C,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,SAAS;0BACd,SAAS,CAAC,2BAA2B,EAAE,MAAM;;UAG3D,sBAAsB;cACpB,MAAM,cAAc,qBAAqB;qBAClC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,EAAE,OAAO,QAAU,SAAS,CAAC,OAAO;;;IAGzE,EAGG,AAHH;;;GAGG,AAHH,EAGG,OACG,cAAc,CAAC,MAAc,EAAE,KAAY;QAC/C,EAA4C,AAA5C,0CAA4C;eACrC,OAAO,EAAE,IAAI,UAAU,OAAO,CAAC,GAAG;iBAAO,QAAQ,CAAC,KAAK;iBAAQ,QAAQ,CAAC,MAAM;;QACrF,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO;mBACb,OAAO,CAAC,IAAI;eAChB,IAAI;;UAGP,oBAAoB,CAAC,KAAY;cAC/B,MAAM,cAAc,gBAAgB;0BACxB,cAAc,CAAC,MAAM,EAAE,KAAK;;IAGhD,EAGG,AAHH;;;GAGG,AAHH,EAGG,OACG,WAAW,CAAC,MAAc;cACxB,IAAI,cAAc,QAAQ,CAAC,MAAM;cACjC,OAAO,CAAC,GAAG;iBAAO,kBAAkB,CAAC,IAAI,CAAC,MAAM;iBAAQ,UAAU,CAAC,MAAM;;eACxE,IAAI;;UAGP,yBAAyB;eACtB,YAAY,EAAE,QAAQ,UAAU,OAAO,CAAC,GAAG;iBAC3C,gBAAgB;iBAChB,YAAY;;cAEb,WAAW,GAAG,QAAQ,CAAC,SAAS,EAAE,IAAI,GAAK,IAAI,CAAC,EAAE,KAAK,YAAY;;YACrE,WAAW,KAAK,EAAE,EACpB,QAAQ,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC;eAEzB,QAAQ;;UAGX,kCAAkC,CAAC,MAAc,EAAE,SAAiB;cAClE,IAAI,cAAc,QAAQ,CAAC,MAAM;QACvC,IAAI,CAAC,oBAAoB,GAAG,SAAS;0BACnB,OAAO,CAAC,IAAI;;IAGhC,cAAc;QACZ,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,OAAO;;;IAIhC,EAAE,GAAY,IAAI;SAEb,MAAM;eACT,OAAO,EAAE,OAAO;QACzB,EAAE,OAAO,OAAO;YACd,OAAO,CAAC,IAAI;;;;IC5Ld,QAAQ,GAAG,CAAC;IACZ,SAAS,GAAG,CAAC;IACb,SAAS;;IACT,SAAS;IACT,MAAM,IAAG,0BAA4B;IAErC,EAAE,IAAI,CAAC,GAAK,CAAC;;IACb,GAAG,GAAG,SAAS,CAAC,GAAG;IACnB,OAAO,GAAG,KAAK,CAAC,OAAO;IACvB,OAAO,UACF,qBAAqB,MAAK,SAAW,IACxC,qBAAqB,GACrB,UAAU;IAEZ,WAAW,IAAI,GAAG;QAChB,GAAG;eAEI,GAAG,MAAK,MAAQ,UAAS,GAAG;QAEnC,OAAO,CAAC,GAAG;gBACJ,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,OAC/B,GAAG,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC,IAC1B,GAAG,KAAK,GAAG,KAAI,CAAG,KAAI,GAAG;;gBAIpB,CAAC,IAAI,GAAG,KACX,GAAG,CAAC,CAAC,GAAG,GAAG,KAAK,GAAG,KAAI,CAAG,KAAI,CAAC;;WAIhC,GAAG;;IAGR,aAAa,IAAI,CAAC,EAAE,CAAC;YACd,CAAC;WAAS,CAAC;WAAK,CAAC;;oBACZ,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,QAAO,QAAU,GACxD,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;iBACD,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,UAAU,IAAI;;;IAIrC,SAAS,IAAI,OAAO,EAAE,OAAO,GAAG,SAAS,EAAE,QAAQ;YAE/C,IAAI,OAAO,CAAC,GAAG,CAAC,EAAE,MAAM,EAAE,MAAM,EACpC,CAAC,GAAG,OAAO,CAAC,MAAM,IAAI,CAAC,GAAG,OAAO,CAAC,MAAM,EACxC,CAAC;QAED,MAAM,GAAG,OAAO,CAAC,CAAC;QAClB,MAAM,GAAG,OAAO,CAAC,CAAC;QAElB,IAAI,CAAC,IAAI,CACP,MAAM,IAAI,MAAM,KAAK,IAAI,IACpB,MAAM,IACP,MAAM,CAAC,CAAC,MAAM,MAAM,CAAC,CAAC,KACtB,aAAa,CAAC,MAAM,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC;YAE7B,MAAM,CAAC,CAAC;YACR,MAAM,CAAC,CAAC;aACP,MAAM,IAAI,MAAM,CAAC,CAAC,KAAK,MAAM,CAAC,CAAC,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC;YAEtD,MAAM,GACR,MAAM,IAAI,MAAM,CAAC,CAAC;;WAGnB,IAAI;;IAGT,MAAM,IAAI,IAAI,GAAM,IAAI,IAAI,IAAI,GAAG,IAAI,GAAG,IAAI,CAAC,GAAG;;IAElD,aAAa,IAAI,IAAI,EAAE,GAAG,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,KAAK;QAC7D,GAAG,MAAK,GAAK;aACN,GAAG,MAAK,KAAO,WACf,CAAC;WAAS,QAAQ;WAAK,QAAQ;;QACtC,QAAQ,GAAG,QAAQ,IAAI,IAAI,IAAI,QAAQ,CAAC,CAAC,KAAK,IAAI,QAAQ,QAAQ,CAAC,CAAC;YAChE,CAAC,CAAC,CAAC,OAAM,CAAG,GACd,IAAI,CAAC,GAAG,EAAE,WAAW,CAAC,CAAC,EAAE,QAAQ;aAEjC,IAAI,CAAC,GAAG,EAAE,CAAC,IAAI,QAAQ;;aAGlB,GAAG,CAAC,CAAC,OAAM,CAAG,KAAI,GAAG,CAAC,CAAC,OAAM,CAAG;eAEpC,IAAI,CAAC,MAAM,KAAK,IAAI,CAAC,MAAM;YAAS,GAAG,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC,KAAM,QAAQ,GAEtE,IAAI,CAAC,mBAAmB,CAAC,GAAG,EAAE,QAAQ;kBAC5B,QAAQ,EAClB,IAAI,CAAC,gBAAgB,CAAC,GAAG,EAAE,QAAQ;gBAE3B,KAAK,IAAI,GAAG,MAAK,IAAM,KAAI,GAAG,MAAK,IAAM,KAAI,GAAG,IAAI,IAAI,EAClE,IAAI,CAAC,GAAG,IAAI,QAAQ,IAAI,IAAI,QAAQ,QAAQ;aAE5C,QAAQ,IAAI,IAAI,IAChB,QAAQ,KAAK,KAAK,IACjB,GAAG,MAAK,KAAO,OAAM,QAAQ,GAAG,WAAW,CAAC,QAAQ,IAErD,IAAI,CAAC,eAAe,CAAC,GAAG;SAExB,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,QAAQ;;IAI/B,UAAU,IAAI,IAAI,EAAE,QAAQ,EAAE,KAAK;QACjC,KAAK,GAAG,IAAI,CAAC,KAAK;QAClB,IAAI,GACN,IAAI,CAAC,IAAI,KAAK,SAAS,GACnB,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,KAC/B,KAAK,GAAG,KAAK,IAAI,IAAI,CAAC,GAAG,MAAK,GAAK,KACpC,QAAQ,CAAC,eAAe,CAAC,MAAM,EAAE,IAAI,CAAC,GAAG;QAAI,EAAE,EAAE,KAAK,CAAC,EAAE;SACzD,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,GAAG;QAAI,EAAE,EAAE,KAAK,CAAC,EAAE;;YAE5C,CAAC,IAAI,KAAK,CACjB,aAAa,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC,GAAG,QAAQ,EAAE,KAAK;YAG/C,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,GACzC,IAAI,CAAC,WAAW,CACd,UAAU,CACP,IAAI,CAAC,QAAQ,CAAC,CAAC,IAAI,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,IAC9C,QAAQ,EACR,KAAK;WAKH,IAAI,CAAC,IAAI,GAAG,IAAI;;IAGtB,KAAK,IAAI,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,KAAK;QACxD,QAAQ,KAAK,QAAQ;aAEvB,QAAQ,IAAI,IAAI,IAChB,QAAQ,CAAC,IAAI,KAAK,SAAS,IAC3B,QAAQ,CAAC,IAAI,KAAK,SAAS;YAEvB,QAAQ,CAAC,GAAG,KAAK,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC,GAAG;eACvD,QAAQ,IAAI,IAAI,IAAI,QAAQ,CAAC,GAAG,KAAK,QAAQ,CAAC,GAAG;QAC1D,IAAI,GAAG,MAAM,CAAC,YAAY,CACxB,UAAU,CAAE,QAAQ,GAAG,UAAU,CAAC,QAAQ,GAAI,QAAQ,EAAE,KAAK,GAC7D,IAAI;YAEF,QAAQ,IAAI,IAAI,EAClB,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI;;YAG9B,OAAO;YACP,OAAO;YAEP,MAAM;YACN,MAAM;YAEN,QAAQ,GAAG,QAAQ,CAAC,KAAK;YACzB,QAAQ,GAAG,QAAQ,CAAC,KAAK;YAEzB,QAAQ,GAAG,QAAQ,CAAC,QAAQ;YAC5B,QAAQ,GAAG,QAAQ,CAAC,QAAQ;YAE5B,OAAO,GAAG,CAAC;YACX,OAAO,GAAG,CAAC;YACX,OAAO,GAAG,QAAQ,CAAC,MAAM,GAAG,CAAC;YAC7B,OAAO,GAAG,QAAQ,CAAC,MAAM,GAAG,CAAC;QAEjC,KAAK,GAAG,KAAK,IAAI,QAAQ,CAAC,GAAG,MAAK,GAAK;gBAE9B,CAAC;eAAS,QAAQ;eAAK,QAAQ;eAEnC,CAAC,MAAK,KAAO,KAAI,CAAC,MAAK,QAAU,KAAI,CAAC,MAAK,OAAS,IACjD,IAAI,CAAC,CAAC,IACN,QAAQ,CAAC,CAAC,OAAO,QAAQ,CAAC,CAAC,GAE/B,aAAa,CAAC,IAAI,EAAE,CAAC,EAAE,QAAQ,CAAC,CAAC,GAAG,QAAQ,CAAC,CAAC,GAAG,QAAQ,EAAE,KAAK;cAI7D,OAAO,IAAI,OAAO,IAAI,OAAO,IAAI,OAAO;iBAE1C,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,OAAO,OAAO,IAAI,IAC5C,MAAM,KAAK,MAAM,CAAC,QAAQ,CAAC,OAAO;YAKpC,KAAK,CACH,IAAI,EACJ,QAAQ,CAAC,OAAO,EAAE,IAAI,EACtB,QAAQ,CAAC,OAAO,GACf,QAAQ,CAAC,OAAO,IAAI,UAAU,CAC7B,QAAQ,CAAC,OAAO,KAChB,QAAQ,CAAC,OAAO,MAElB,QAAQ,EACR,KAAK;;cAIF,OAAO,IAAI,OAAO,IAAI,OAAO,IAAI,OAAO;iBAE1C,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,OAAO,OAAO,IAAI,IAC5C,MAAM,KAAK,MAAM,CAAC,QAAQ,CAAC,OAAO;YAKpC,KAAK,CACH,IAAI,EACJ,QAAQ,CAAC,OAAO,EAAE,IAAI,EACtB,QAAQ,CAAC,OAAO,GACf,QAAQ,CAAC,OAAO,IAAI,UAAU,CAC7B,QAAQ,CAAC,OAAO,KAChB,QAAQ,CAAC,OAAO,MAElB,QAAQ,EACR,KAAK;;YAIL,OAAO,GAAG,OAAO,QACZ,OAAO,IAAI,OAAO,CACvB,IAAI,CAAC,YAAY,CACf,UAAU,CACP,QAAQ,CAAC,OAAO,IAAI,UAAU,CAAC,QAAQ,CAAC,OAAO,MAChD,QAAQ,EACR,KAAK,IAEN,OAAO,GAAG,QAAQ,CAAC,OAAO,MAAM,OAAO,CAAC,IAAI;iBAGxC,OAAO,GAAG,OAAO,QACnB,OAAO,IAAI,OAAO,CACvB,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,OAAO,IAAI,IAAI;;oBAGlC,KAAK;eAAO,QAAQ;eAAO,CAAC,GAAG,OAAO,EAAE,CAAC,IAAI,OAAO,EAAE,CAAC,QACzD,MAAM,GAAG,QAAQ,CAAC,CAAC,EAAE,GAAG,KAAK,IAAI,EACpC,KAAK,CAAC,MAAM,IAAI,QAAQ,CAAC,CAAC;kBAIvB,OAAO,IAAI,OAAO;gBACvB,MAAM,GAAG,MAAM,CAAE,OAAO,GAAG,QAAQ,CAAC,OAAO;gBAC3C,MAAM,GAAG,MAAM,CACZ,QAAQ,CAAC,OAAO,IAAI,UAAU,CAAC,QAAQ,CAAC,OAAO,GAAG,OAAO;oBAI1D,QAAQ,CAAC,MAAM,KACd,MAAM,IAAI,IAAI,IAAI,MAAM,KAAK,MAAM,CAAC,QAAQ,CAAC,OAAO,GAAG,CAAC;wBAErD,MAAM,IAAI,IAAI,EAChB,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI;oBAE/B,OAAO;;;oBAIL,MAAM,IAAI,IAAI,IAAI,QAAQ,CAAC,IAAI,KAAK,QAAQ;wBAC1C,MAAM,IAAI,IAAI;wBAChB,KAAK,CACH,IAAI,EACJ,OAAO,IAAI,OAAO,CAAC,IAAI,EACvB,OAAO,EACP,QAAQ,CAAC,OAAO,GAChB,QAAQ,EACR,KAAK;wBAEP,OAAO;;oBAET,OAAO;;wBAEH,MAAM,KAAK,MAAM;wBACnB,KAAK,CACH,IAAI,EACJ,OAAO,CAAC,IAAI,EACZ,OAAO,EACP,QAAQ,CAAC,OAAO,GAChB,QAAQ,EACR,KAAK;wBAEP,QAAQ,CAAC,MAAM,IAAI,IAAI;wBACvB,OAAO;gCAEF,OAAO,GAAG,KAAK,CAAC,MAAM,MAAM,IAAI;wBACnC,KAAK,CACH,IAAI,EACJ,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,EAAE,OAAO,IAAI,OAAO,CAAC,IAAI,GACvD,OAAO,EACP,QAAQ,CAAC,OAAO,GAChB,QAAQ,EACR,KAAK;wBAEP,QAAQ,CAAC,MAAM,IAAI,IAAI;2BAEvB,KAAK,CACH,IAAI,EACJ,OAAO,IAAI,OAAO,CAAC,IAAI,EACvB,IAAI,EACJ,QAAQ,CAAC,OAAO,GAChB,QAAQ,EACR,KAAK;oBAIX,OAAO;;;kBAIJ,OAAO,IAAI,OAAO,KACnB,MAAM,CAAE,OAAO,GAAG,QAAQ,CAAC,OAAO,QAAS,IAAI,EACjD,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI;oBAIxB,CAAC,IAAI,KAAK,KACb,QAAQ,CAAC,CAAC,KAAK,IAAI,EACrB,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE,IAAI;;;WAM9B,QAAQ,CAAC,IAAI,GAAG,IAAI;;IAG1B,YAAY,IAAI,CAAC,EAAE,CAAC;YACb,CAAC,IAAI,CAAC,KAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,UAAU,IAAI;YACtC,CAAC,IAAI,CAAC,KAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,UAAU,IAAI;;IAG7C,UAAU,IAAI,QAAQ,EAAE,QAAQ,GAClC,QAAQ,KAAK,IAAI,IAAI,QAAQ,KAAK,KAAK,IAAI,QAAQ,UACxC,QAAQ,CAAC,GAAG,MAAK,QAAU,OAC7B,QAAQ,IACT,QAAQ,CAAC,IAAI,IAAI,IAAI,IACrB,YAAY,CAAC,QAAQ,CAAC,IAAI,EAAE,QAAQ,CAAC,IAAI,QACvC,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,GAAG,IAAI,GAAG,QAAQ,CAAC,IAAI,GAChE,QAAQ,IACR,QAAQ,GACV,IAAI;;IAEN,WAAW,IAAI,IAAI,GACrB,IAAI,CAAC,QAAQ,KAAK,SAAS,GACvB,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,IACzB,WAAW,CACT,IAAI,CAAC,QAAQ,CAAC,WAAW,IACzB,SAAS,EACT,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,WAAW,GACrC,QAAQ,EACR,IAAI;;IAGR,WAAW,IAAI,GAAG,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,IAAI;QACjD,GAAG;QACH,KAAK;QACL,GAAG,EAAE,KAAK,CAAC,GAAG;QACd,QAAQ;QACR,IAAI;QACJ,IAAI;;;IAKK,IAAI,IAAI,KAAK,EAAE,IAAI,GAC5B,WAAW,CAAC,KAAK,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,IAAI;;IAE/C,CAAC,IAAI,GAAG,EAAE,KAAK,EAAE,QAAQ,GAAG,SAAS,GAC9C,WAAW,CAAC,GAAG,EAAE,KAAK,EAAE,OAAO,CAAC,QAAQ,IAAI,QAAQ;QAAI,QAAQ;;;IAEvD,GAAG,MACZ,IAAI,GACJ,IAAI,GACJ,aAAa,GACb,QAAQ,EAAG,EAAE,GACb,IAAI,EAAG,SAAS;QAEZ,IAAI,GAAG,IAAI,IAAI,WAAW,CAAC,IAAI;QAC/B,IAAI;QACJ,KAAK;QACL,IAAI;QAEJ,MAAM,IAAI,QAAQ;YAChB,KAAK,KAAK,QAAQ;iBACf,KAAK,GAAG,QAAQ,KAAK,IAAI,EAAE,QAAQ,GAAG,aAAa,GAAG,MAAM,GAAG,EAAE;gBAClE,aAAa,EAAE,IAAI,GAAG,SAAS,CAAC,IAAI,EAAE,aAAa,CAAC,KAAK,GAAG,QAAQ;gBACpE,IAAI,KAAK,IAAI,EAAE,OAAO,CAAC,MAAM,EAAG,IAAI,GAAG,IAAI;;;QAI/C,MAAM,OACP,IAAI,GAAG,KAAK,CACX,IAAI,CAAC,UAAU,EACf,IAAI,EACJ,IAAI,EACH,IAAI,GAAG,IAAI,CAAC,KAAK,GAClB,QAAQ,EACP,IAAI,GAAG,KAAK;;QAGb,QAAQ,YAAa,KAAK;QAC5B,QAAQ,MAAM,MAAM,CAAC,KAAK,CAAC,IAAI,GAAG,KAAK;;YAItC,QAAQ,GAAG,QAAQ,EAAE,MAAM,EAAE,KAAK,UAC1B,MAAM,MAAK,QAAU,IACxB,QAAQ,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,KAC5B,OAAO,CAAC,MAAM,WACP,MAAM,CAAC,CAAC,OAAM,QAAU,IAC7B,QAAQ,CAAC,MAAM,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,KAC5B,MAAM,CACH,KAAK,CAAC,CAAC,EACP,GAAG,EACD,EAAE,GAAK,EAAE,IAAI,EAAE,KAAK,IAAI,IAAI,EAAE,CAAC,CAAC,EAAE,QAAQ,EAAE,EAAE,CAAC,CAAC;UACjD,MAAM,CAAC,MAAM,CAAC,CAAC,MAErB,MAAM,CAAC,MAAM;OAChB,IAAI,GACP,QAAQ;;SC/YI,WAAW;UACnB,MAAM,GAAG,QAAQ,CAAC,aAAa,EAAC,KAAO;UACvC,MAAM,GAAG,QAAQ,CAAC,aAAa,EAAC,MAAQ;UACxC,GAAG,GAAG,MAAM,CAAC,UAAU,EAAC,EAAI;QAC9B,OAAO,GAAG,KAAK;IAEnB,MAAM,CAAC,WAAW,GAAG,IAAI,CAAE,CAAqC,AAArC,EAAqC,AAArC,mCAAqC;IAEhE,SAAS,CAAC,YAAY,CACnB,YAAY;QACX,KAAK;YAAI,UAAU,GAAE,WAAa;;OAEnC,IAAI,EAAE,MAAM;QACX,MAAM,CAAC,SAAS,GAAG,MAAM;QACzB,SAAS;OAEV,KAAK,EAAE,GAAG,GAAK,OAAO,CAAC,KAAK,EAAC,kDAAoD,GAAE,GAAG;;IAEzF,MAAM,CAAC,gBAAgB,EAAC,OAAS,GAAE,UAAU;IAC7C,MAAM,CAAC,gBAAgB,EAAC,MAAQ,GAAE,UAAU;aAEnC,UAAU;QACjB,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,UAAU;QAChC,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC,WAAW;;IAGpC,EAEG,AAFH;;GAEG,AAFH,EAEG,UACM,IAAI;QACX,UAAU;QACV,GAAG,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM;eAChD,MAAM,CAAC,SAAS,EAAC,SAAW;;aAG5B,eAAe;eACf,MAAM;;aAGN,SAAS;eACT,MAAM,CACV,IAAI,GACJ,KAAK,EAAE,CAAC;YACP,OAAO,CAAC,GAAG,EAAC,yBAA2B,GAAE,CAAC;YAC1C,OAAO,GAAG,KAAK;mBACR,CAAC;WAET,IAAI,EAAE,CAAC;YACN,OAAO,CAAC,GAAG,EAAC,2BAA6B,GAAE,CAAC;YAC5C,OAAO,GAAG,IAAI;mBACP,CAAC;;;;QAKZ,IAAI;QACJ,eAAe;QACf,SAAS;QACT,SAAS,MAAQ,OAAO;;;SAIZ,gBAAgB,CAAC,GAAW;WACnC,KAAK,CAAC,GAAG,EAAE,IAAI,EAAE,QAAQ,GAAK,QAAQ,CAAC,WAAW;;;SAG3C,UAAU,CAAC,GAAW,EAAE,GAAiB;WAChD,gBAAgB,CAAC,GAAG,EAAE,IAAI,EAAE,MAAM,GAAK,GAAG,CAAC,eAAe,CAAC,MAAM;;;OAGnE,MAAM,CAAC,YAAY;MAEb,WAAW;;aAMf,QAAQ,MAAK,YAAc,KAAI,MAAM;kBAChC,QAAQ;iBACX,YAAY,OAAO,YAAY;iBAC/B,KAAK,OAAO,GAAG;eAEpB,OAAO,CAAC,IAAI,EAAC,uEAAyE;;UAIpF,IAAI,CAAC,GAAW;iBACX,QAAQ,aACJ,KAAK,EAAC,0BAA4B;cAEzC,MAAM,SAAS,UAAU,CAAC,GAAG,OAAO,YAAY;aACjD,KAAK,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM;eACnB,MAAM;;IAGf,EAAmF,AAAnF,iFAAmF;IAC3E,GAAG,CAAC,GAAW;iBACZ,KAAK,CAAC,GAAG,CAAC,GAAG,eACR,KAAK,CAAC,GAAG,CAAC,GAAG;aAEtB,IAAI,CAAC,GAAG;QACb,OAAO,CAAC,IAAI,EAAC,4CAA8C;oBAC/C,YAAY,CAAC,YAAY,CAAC,CAAC,EAAE,KAAK,EAAE,KAAK;;IAG/C,wBAAwB,CAAC,GAAW;cACpC,MAAM,QAAQ,YAAY,CAAC,kBAAkB;QACnD,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAC,GAAG;QAC5B,MAAM,CAAC,OAAO,MAAM,YAAY,CAAC,WAAW;eACrC,MAAM;;IAGf,IAAI,CAAC,GAAW;iBACL,QAAQ,aACJ,KAAK,EAAC,0BAA4B;cAEzC,MAAM,QAAQ,wBAAwB,CAAC,GAAG;QAChD,MAAM,CAAC,KAAK,CAAC,CAAC;eACP,MAAM;;IAGf,IAAI,CAAC,GAAW;iBACL,QAAQ,aACJ,KAAK,EAAC,0BAA4B;cAEzC,MAAM,QAAQ,wBAAwB,CAAC,GAAG;QAChD,MAAM,CAAC,IAAI,GAAG,IAAI;QAClB,MAAM,CAAC,KAAK,CAAC,CAAC;eACP,MAAM;;;MAIJ,iBAAiB,OAAO,WAAW;SCtIhC,QAAQ,CAAC,IAAY,EAAE,IAAI,IAAG,OAAS;UAC/C,CAAC,GAAG,QAAQ,CAAC,aAAa,EAAC,CAAG;IACpC,CAAC,CAAC,IAAI,GAAG,IAAI;IACb,CAAC,CAAC,QAAQ,GAAG,IAAI;IACjB,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;IAC3B,CAAC,CAAC,KAAK;IACP,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;;SAGpB,QAAQ,CAAC,MAAc;UACxB,SAAS,OAAO,WAAW,CAAC,MAAM,CAAC,MAAM;YACtC,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,GACrC,SAAS,CAAC,CAAC,IAAI,MAAM,CAAC,UAAU,CAAC,CAAC;WAE7B,MAAM,CAAC,YAAY,QAAQ,UAAU,CAAC,SAAS,CAAC,MAAM;;SAGtD,mBAAmB,CAAC,WAAwB;UAC7C,OAAO,OAAO,WAAW,EAAC,IAAM;UAChC,OAAO,GAAG,OAAO,CAAC,MAAM,CAAC,WAAW;UACpC,YAAY,GAAG,QAAQ,CAAC,OAAO;WAC9B,IAAI,CAAC,YAAY;;SAGV,SAAS,CAAC,KAAa;UAC/B,GAAG,OAAO,WAAW;UACrB,KAAK,GAAG,GAAG,CAAC,MAAM,CAAC,KAAK;WACvB,MAAM,CAAC,MAAM,CAAC,MAAM,EAAC,KAAO,GAAE,KAAK,EAAE,IAAI,CAAC,mBAAmB;;SAGtD,aAAa,CAAC,KAAa;WAClC,SAAS,CAAC,KAAK,EAAE,IAAI,EACzB,IAAI,GAAK,IAAI,CAAC,OAAO,WAAW,OAAO,YAAY,SAAS,CAAC,CAAC,EAAE,EAAE,KAAI,IAAM;;;eAO3D,WAAW,CAAC,KAAa;UACvC,GAAG,SAAS,KAAK,CAAC,KAAK;UACvB,MAAM,SAAS,GAAG,CAAC,WAAW;UAC9B,IAAI,SAAS,MAAM,CAAC,MAAM,CAAC,MAAM,EAAC,KAAO,GAAE,MAAM;UACjD,UAAU,GAAG,mBAAmB,CAAC,IAAI;UACrC,QAAQ,GAAG,UAAU,CAAC,OAAO,WAAW,OAAO,YAAY,SAAS,CAAC,CAAC,EAAE,EAAE,KAAI,IAAM;UAEpF,IAAI,OAAO,IAAI;QAAE,MAAM;OAAG,QAAQ;QACtC,IAAI,GAAE,SAAW;;WAEZ,IAAI;;eAGS,aAAa,CAAC,MAAgB;WAC5C,KAAO,KAAI,MAAM,CAAC,SAAS,GAC/B,EAAsB,AAAtB,oBAAsB;WACf,OAAO,CAAC,OAAO,KAAK,KAAK,EAAC,6BAA+B;UAG5D,KAAK,SAAS,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,WAAW;UAChD,SAAS;QAAK,KAAK;;iBACZ,SAAS,CAAC,KAAK,CAAC,SAAS;;SC5E/B,sBAAsB;UACvB,SAAS;UAET,gBAAgB,GAAG,MAAM,CAAC,YAAY,CAAC,gBAAgB;QACzD,gBAAgB;QAClB,SAAS,CAAC,IAAI,CAAC,gBAAgB;QAC/B,SAAS,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAC,CAAG,GAAE,CAAC;;IAG9C,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ;IACxC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,KAAK,EAAC,CAAG,GAAE,CAAC;IACrD,SAAS,CAAC,IAAI,EAAC,EAAI;WAEZ,SAAS;;MAGZ,aAAa,GAAG,sBAAsB;AAE5C,OAAO,CAAC,GAAG;IAAG,aAAa;;SAElB,OAAO,CAAC,IAAqC;eACzC,IAAI,IAAI,aAAa;YAC1B,SAAS,GAAG,IAAI,CAAC,IAAI;YACrB,SAAS,SACJ,SAAS;;IAGpB,OAAO,CAAC,KAAK,EAAC,oBAAsB;YAC7B,GAAK;;MAGR,CAAC,IAAI,IAAa,EAAE,KAAY,GAAM,IAAI,GAAG,KAAI;;MAE1C,0BAA0B,OACrC,OAAO;QACL,EAAE,OAAQ,uDAAsD;;QAC/D,EAAC,OAAQ,yCAA2C;;;MAG5C,QAAO,OAClB,OAAO;QACL,EAAE,OAAQ,OAAS;;QACnB,EAAE,OAAQ,OAAS;;;MAGV,KAAI,OACf,OAAO;QACL,EAAE,OAAQ,SAAW;;QACrB,EAAE,OAAQ,IAAM;;;MAGP,cAAc,OACzB,OAAO;QACL,EAAE,OAAQ,aAAe;;QACzB,EAAE,OAAQ,iBAAmB;;;MAGpB,IAAI,OACf,OAAO;QACL,EAAE,OAAQ,SAAQ;;QACjB,EAAC,OAAQ,IAAM;;;MAGP,WAAW,OACtB,OAAO;QACL,EAAE,OAAQ,aAAe;;QACzB,EAAE,OAAQ,QAAU;;;MAGX,sBAAsB,OACjC,OAAO;QACL,EAAE,OAAQ,eAAiB;;QAC3B,EAAE,OAAQ,mBAAqB;;;MAGtB,wBAAwB,OACnC,OAAO;QACL,EAAE,OAAQ,2EAA0E;;QACpF,EAAE,OAAQ,iEAAmE;;;MAGpE,KAAK,OAChB,OAAO;QACL,EAAE,OAAQ,QAAU;;QACpB,EAAE,OAAQ,KAAO;;;MAGR,cAAc,IAAI,KAAa;UACpC,MAAM,GAAG,KAAK,KAAK,CAAC;WACnB,OAAO;QACZ,EAAE,OACC,SAAS,EAAE,MAAM,IAAG,GAAK,KAAG,IAAM,EAAC,CAAC,EAAE,KAAK,CAAC,KAAK,EAAE,CAAC,EAAE,MAAM,GAAE,CAAG,GAAE,oBAAoB;;QAC1F,EAAE,OAAS,MAAM,EAAE,MAAM,IAAG,EAAI,KAAG,GAAK,EAAC,WAAW,EAAE,KAAK,CAAC,KAAK,EAAE,CAAC,EAAE,MAAM,GAAE,CAAG,GAAE,WAAW;;;MAI5F,GAAG,OACP,OAAO;QACL,EAAE,OAAQ,GAAK;;QACf,EAAE,OAAQ,GAAK;;;MAGb,IAAI,OACR,OAAO;QACL,EAAE,OAAQ,KAAO;;QACjB,EAAE,OAAQ,IAAM;;;MAGd,IAAI,OACR,OAAO;QACL,EAAE,OAAQ,MAAQ;;QAClB,EAAE,OAAQ,IAAM;;;MAGd,KAAK,OACT,OAAO;QACL,EAAE,OAAQ,OAAS;;QACnB,EAAE,OAAQ,KAAO;;;MAGf,MAAM,OACV,OAAO;QACL,EAAE,OAAQ,MAAQ;;QAClB,EAAE,OAAQ,MAAQ;;;MAGhB,OAAO,OACX,OAAO;QACL,EAAE,OAAQ,OAAS;;QACnB,EAAE,OAAQ,OAAS;;;SAGP,UAAU,CAAC,IAAY;UAC/B,aAAa,GAAG,IAAI,GAAG,IAAI;UAC3B,aAAa,GAAG,aAAa,GAAG,EAAE;UAClC,WAAW,GAAG,aAAa,GAAG,EAAE;UAChC,UAAU,GAAG,WAAW,GAAG,EAAE;QAE/B,UAAU,GAAG,CAAC;cACV,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU;eAC1B,GAAG,IAAG,CAAG,KAAI,GAAG,KAAK,CAAC,GAAG,GAAG,KAAK,IAAI;;QAG1C,WAAW,GAAG,CAAC;cACX,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW;eAC3B,GAAG,IAAG,CAAG,KAAI,GAAG,KAAK,CAAC,GAAG,IAAI,KAAK,KAAK;;QAG5C,aAAa,GAAG,CAAC;cACb,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,aAAa;eAC7B,GAAG,IAAG,CAAG,KAAI,GAAG,KAAK,CAAC,GAAG,MAAM,KAAK,OAAO;;WAG7C,OAAO;QACZ,EAAE,OAAQ,wBAA0B;;QACpC,EAAE,OAAQ,cAAgB;;;MAIjB,WAAW,IAAI,IAAY,GACtC,OAAO;QACL,EAAE,OAAS,eAAe,EAAE,UAAU,CAAC,IAAI;;QAC3C,EAAE,OAAS,0BAA0B,EAAE,UAAU,CAAC,IAAI;;;MClK7C,gBAAgB,IAAG,mBAAqB;MCExC,OAAM;MAEb,aAAa,GAAG,IAAI;MAEpB,WAAW,GAAG,YAAY;AAChC,WAAW,CAAC,KAAK,CAAC,IAAI,IAAG,CAAG;MACtB,YAAY,GAAG,YAAY;AACjC,YAAY,CAAC,KAAK,CAAC,KAAK,IAAG,CAAG;SAErB,YAAY;UACb,OAAO,GAAG,QAAQ,CAAC,aAAa,EAAC,GAAK;IAC5C,OAAO,CAAC,KAAK,CAAC,MAAM,IAAG,IAAM;IAC7B,OAAO,CAAC,KAAK,CAAC,KAAK,IAAG,GAAK;IAC3B,OAAO,CAAC,KAAK,CAAC,UAAU,IAAG,KAAO;IAClC,OAAO,CAAC,KAAK,CAAC,QAAQ,IAAG,QAAU;IACnC,OAAO,CAAC,KAAK,CAAC,GAAG,IAAG,CAAG;IACvB,OAAO,CAAC,KAAK,CAAC,UAAU,GAAG,aAAa,IAAG,CAAG;WACvC,OAAO;;SAGA,mBAAmB;IACjC,WAAW,CAAC,KAAK,CAAC,KAAK,IAAG,IAAM;IAChC,YAAY,CAAC,KAAK,CAAC,KAAK,IAAG,IAAM;IACjC,UAAU;QACR,WAAW,CAAC,KAAK,CAAC,KAAK,IAAG,CAAG;QAC7B,YAAY,CAAC,KAAK,CAAC,KAAK,IAAG,CAAG;QAvBZ,IAAI,GACE,GAAG,IAuBc,IAAI;;SAGxC,wBAAwB;UACzB,UAAU,GAAG,QAAQ,CAAC,cAAc,EAAC,UAAY;UACjD,UAAU,GAAG,QAAQ,CACzB,MAAM,CAAC,gBAAgB,CAAC,QAAQ,CAAC,aAAa,EAAC,iBAAmB,IAAG,KAAK,EAC1E,EAAE;IAEJ,UAAU,CAAC,KAAK,CAAC,IAAI,IAAI,QAAQ,CAAC,eAAe,CAAC,WAAW,GAAG,UAAU,IAAI,CAAC,IAAG,EAAI;;SAG/E,gBAAgB;UACjB,UAAU,GAAG,QAAQ,CAAC,cAAc,EAAC,UAAY;UACjD,YAAY,GAAG,OAAM,CAAC,eAAe;IAC3C,OAAO,CAAC,GAAG,EAAC,mBAAqB;IACjC,YAAY,CAAC,KAAK,CAAC,KAAK,IAAG,KAAO;IAClC,UAAU,CAAC,WAAW,CAAC,WAAW;IAClC,UAAU,CAAC,WAAW,CAAC,YAAY;IACnC,UAAU,CAAC,WAAW,CAAC,YAAY;IACnC,wBAAwB;IAExB,MAAM,CAAC,gBAAgB,EAAC,MAAQ;QAC9B,wBAAwB;;;AAI5B,EAA6E,AAA7E,2EAA6E;SACpE,qBAAqB;UACtB,UAAU,GAAG,QAAQ,CAAC,cAAc,EAAC,UAAY;QACnD,UAAU;QACZ,gBAAgB;QAChB,OAAO,CAAC,GAAG,EAAC,gCAAkC;eACvC,IAAI;;QAEX,OAAO,CAAC,GAAG,EAAC,2BAA6B;eAClC,KAAK;;;SAIP,mBAAmB;UACpB,EAAE,GAAG,MAAM,CAAC,WAAW,GAAG,IAAI;IACpC,QAAQ,CAAC,eAAe,CAAC,KAAK,CAAC,WAAW,EAAC,IAAM,GAAE,EAAE,IAAG,EAAI;;SAG9C,qBAAqB;IACnC,EAA4C,AAA5C,0CAA4C;IAC5C,OAAM,CAAC,eAAe,GAAG,gBAAgB,EAAC,OAAS;cAC3C,mBAAmB,GAAG,WAAW;gBACjC,qBAAqB,IACvB,aAAa,CAAC,mBAAmB;WAElC,GAAG;;IAGR,EAA8B,AAA9B,4BAA8B;IAC9B,MAAM,CAAC,gBAAgB,EAAC,MAAQ,GAAE,mBAAmB;IACrD,mBAAmB;;;UCxET,KAAI;IAAJ,KAAI,EACd,MAAM,MAAG,QAAU;IADT,KAAI,EAEd,IAAI,MAAG,MAAQ;IAFL,KAAI,EAGd,OAAO,MAAG,SAAW;GAHX,IAAI,KAAJ,IAAI;;MCJH,qBAAqB,IAAI,KAAY;WAC7C,KAAK;QACR,wBAAwB,EAAE,IAAI;;;MAGnB,kBAAkB,IAAI,KAAY;;eACxC,KAAK;YAAE,wBAAwB,EAAE,KAAK;;;;wBAGhC,SAAS;;;;;MAKT,SAAS,IAAI,KAAY;QACpC,KAAK;;aAEF,QAAQ;6BACK,SAAS;oBACnB,QAAQ,CAAC,qBAAqB;;;sBAI1B,GAAG,WAAU,IAAI;;kCAEL,IAAI;mBACnB,oBAAoB,CAAC,GAAG,EAAE,IAAI,EAAE,IAAI;oBACrC,QAAQ,CAAC,aAAa,EAAE,IAAI;;;;;;MAMvB,aAAa,IAAI,KAAY,EAAE,KAAY;QACtD,KAAK;;;8BAGa,KAAK,EAAE,IAAI,EAAE,IAAI;6BACpB,KAAK,EAAE,IAAI;;;;;;MAMf,yBAAyB,IACpC,KAAY,EACZ,kBAA0B;;WAGrB,KAAK;QACR,kBAAkB;;;MAIT,OAAO,IAAI,KAAY;QAClC,KAAK;;;oBAGG,MAAM,CAAC,OAAO;uBACb,cAAc;oBACjB,MAAM,CAAC,QAAQ,CAAC,MAAM;;;;;;MAMjB,kBAAkB,IAAI,KAAY,EAAE,OAAa;WACzD,KAAK;QACR,UAAU,EAAE,OAAO;;;MAGR,UAAU,IAAI,KAAY;WAClC,KAAK;QACR,WAAW,EAAE,IAAI,CAAC,GAAG;;;MAGV,yBAAyB,IAAI,KAAY,EAAE,KAAU;WAC7D,KAAK;QACR,mBAAmB,EAAE,KAAK,CAAC,MAAM,CAAC,OAAO;;;MAG9B,aAAa,IAAI,KAAY,EAAE,IAAU;;eAE/C,KAAK;YACR,UAAU,EAAE,IAAI;;QAElB,IAAI,CAAC,MAAM,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM;aAC9B,QAAQ;mBACJ,OAAO,GAAG,IAAI,EAAE,SAAS;oBAC1B,OAAO,CAAC,GAAG;2BAAK,eAAe,CAAC,SAAS;2BAAM,QAAQ,CAAC,SAAS;uBAAI,IAAI,KAAK,OAAO;wBACnF,QAAQ,CAAC,kBAAkB,EAAE,OAAO;2BACjC,kCAAkC,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,GAAG,IAAI,IAAI,QAC1D,yBAAyB,GAAG,IAAI,EAAE,KAAK;gCACxC,QAAQ,CAAC,yBAAyB,EAAE,KAAK;;;;;;;;;MAS1C,yBAAyB,IAAI,KAAY,EAAE,MAAc;;eAE/D,KAAK;;;aAGP,QAAQ;mBACJ,WAAW,CAAC,MAAM,EAAE,IAAI,EAAE,aAAa;uBACrC,yBAAyB,GAAG,IAAI,EAAE,KAAK;wBACxC,QAAQ,CAAC,yBAAyB,EAAE,KAAK;;oBAE3C,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,MAAM,CAAC,GAAG,EAAE,OAAO,MAAQ,SAAS,CAAC,OAAO;uBAAI,IAAI,EAAE,MAAM,GACpF,QAAQ,CAAC,YAAY,EAAE,MAAM;;;;;;;MAO1B,YAAY,IAAI,KAAY,EAAE,aAAsB;WAC5D,KAAK;QACR,IAAI,OAAO,OAAO;QAClB,aAAa;;;MAGF,WAAW,IAAI,KAAY;WACnC,KAAK;QACR,IAAI,OAAO,MAAM;;;MAGN,iBAAiB,IAAI,KAAY,IAAI,KAAK,GAAE,KAAK;QACxD,gBAAgB;WAAO,KAAK,CAAC,aAAa;;IAC9C,gBAAgB,CAAC,KAAK,IAAI,KAAK;;WACnB,KAAK;QAAE,aAAa,EAAE,gBAAgB;;;MAGvC,SAAS,IAAI,KAAY;WACjC,KAAK;QACR,IAAI,OAAO,IAAI;;;MAGJ,QAAQ,IAAI,KAAY;WAChC,KAAK;QACR,IAAI,OAAO,MAAM;;;MAGN,gBAAgB,IAAI,KAAY;;eACtC,KAAK;;;aAEP,QAAQ;mBACJ,qBAAqB,GAAG,IAAI,EAAE,QAAQ;oBACvC,QAAQ,CAAC,YAAY,MAAM,KAAK,CAAC,QAAQ,CAAC,MAAM;oBAChD,QAAQ,CAAC,OAAO,EAAE,OAAO,EAAE,KAAK;2BAC3B,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,KAAK,GAAK,QAAQ,CAAC,iBAAiB;gCAAI,KAAK;gCAAE,KAAK;;;;;;;;;MAO7E,mBAAmB,IAAI,KAAY;WAC3C,KAAK;QACR,yBAAyB,EAAE,KAAK;;;MAGrB,oBAAoB,IAAI,KAAY;;eAC1C,KAAK;YAAE,yBAAyB,EAAE,IAAI;;;aAExC,QAAQ;mBACJ,sBAAsB,GAAG,IAAI,EAAE,MAAM;kCACxB,MAAM,EAAE,IAAI,KAAO,QAAQ,CAAC,mBAAmB;;;;;;;MChK/D,OAAO,GAAG,EAAE,GADF,IAAI;MAEd,KAAK,GAAG,EAAE,GAAG,OAAO;MAEpB,gBAAgB,GAAG,GAAG,GAAG,KAAK;MAEvB,aAAa,IAAI,KAAY,MACtC,IAAM;QAAI,KAAK;YAAI,QAAQ,GAAE,MAAQ;;;WAEnC,GAAK;YAEH,KAAK,GAAE,eAAiB;YACxB,KAAK;gBACH,SAAS,EAAE,KAAK,CAAC,IAAI,UAAU,OAAO,IAAG,2BAA6B,KAAG,CAAG;gBAC5E,UAAU,EAAE,KAAK,CAAC,IAAI,UAAU,IAAI,IAAG,MAAQ,KAAG,CAAG;gBACrD,QAAQ,GAAE,QAAU;;;eAIpB,GAAK;gBACL,EAAE,GAAE,UAAY;gBAChB,KAAK;oBACH,QAAQ,GAAE,QAAU;oBACpB,GAAG,GAAE,CAAG;;;YAGZ,OAAM,CAAC,KAAK;YACZ,KAAI,CAAC,KAAK;;QAGd,QAAO,CAAC,KAAK;QACb,oBAAoB,CAAC,KAAK,CAAC,wBAAwB;;;MAG1C,OAAM,IAAI,KAAY,MAC/B,GAAK;QAAI,KAAK,GAAE,MAAQ;;WAEtB,GAAK;YAEH,KAAK,GAAE,iBAAmB;;YAE3B,aAAa,CAAC,KAAK;eAAK,MAAQ;gBAAI,OAAO;gBAAa,KAAK,GAAE,WAAa;;;WAE7E,GAAK;YAAI,KAAK,GAAE,oBAAsB;;eACpC,GAAK;gBAAI,KAAK,GAAE,iBAAmB;;gBAAK,OAAO,CAAC,KAAK;;eAErD,GAAK;gBAAI,KAAK,GAAE,kBAAoB;;mBAClC,MAAQ;oBAAI,KAAK,GAAE,QAAU;oBAAE,OAAO;;;;mBACtC,MAAQ;oBAAI,KAAK,GAAE,QAAU;oBAAE,OAAO;;;;mBACtC,MAAQ;oBAAI,KAAK,GAAE,QAAU;oBAAE,OAAO;;0BAAmB,KAAO;;;;;;MAK7D,aAAa,MAAM,UAAU,SACtC,GAAK;QAAI,KAAK,GAAE,UAAY;;WACzB,KAAK,CAAC,IAAI;YAAG,MAAM,EAAE,UAAU,CAAC,MAAM,CAAC,MAAM;kBAC5C,GAAK;gBAAI,KAAK,GAAE,kBAAoB;;;WAErC,KAAK,CAAC,IAAI;YAAG,MAAM,EAAE,UAAU,CAAC,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC,MAAM;kBAChE,GAAK;gBAAI,KAAK,GAAE,kBAAoB;;;;;MAI/B,OAAO,MAClB,kBAAkB,GAClB,mBAAmB,GACnB,WAAW,SAET,GAAK;QAAI,KAAK;YAAI,SAAS,GAAE,IAAM;;;4BACJ,kBAAkB,CAAC,MAAM;WAEtD,EAAI;YACF,KAAK;gBAAI,WAAW,GAAE,IAAM;gBAAE,UAAU,GAAE,CAAG;gBAAE,SAAS,GAAE,MAAQ;;WACpE,kBAAkB,CAAC,GAAG,EAAE,IAAI,GAAK,WAAW,CAAC,IAAI,EAAE,mBAAmB,EAAE,WAAW;;;;MAI5E,WAAW,IACtB,IAAU,EACV,mBAA4B,EAC5B,WAAmB;UAEb,iBAAiB,GAAG,WAAW,GAAG,IAAI,CAAC,oBAAoB;UAC3D,QAAQ,GAAG,gBAAgB,GAAG,iBAAiB;QACjD,MAAM,GAAG,QAAQ,IAAI,CAAC;QAEtB,mBAAmB,EACrB,MAAM,GAAG,IAAI;cAGN,EAAI;QAAI,KAAK;YAAI,YAAY,GAAE,MAAQ;;;QAC9C,MAAM,MAEA,MAAQ;YAEN,OAAO;;gBAA8B,IAAI,CAAC,EAAE;;YAC5C,KAAK,GAAE,QAAU;;;8BAIO,QAAQ;;;MAI/B,iBAAiB,MAAM,aAAa,SAE7C,GAAK;QACH,KAAK,GAAE,MAAQ;QAAE,KAAK;YAAI,YAAY,GAAE,IAAM;;OAChD,aAAa,CAAC,GAAG,EAAE,KAAK,MACpB,GAAK;YACL,GAAG,EAAE,KAAK;YACV,KAAK,GAAE,cAAgB;YACvB,OAAO;;gBAAkB,KAAK;;;;;MAKzB,QAAO,MAAM,aAAa,GAAE,yBAAyB,SAC9D,GAAK;QAAI,KAAK,GAAE,OAAS;;WACvB,GAAK;YAAI,KAAK,GAAE,eAAiB;YAAE,KAAK;gBAAI,UAAU,GAAE,MAAQ;gBAAE,YAAY,GAAE,IAAM;;;eACpF,EAAI;gBAAI,KAAK;oBAAI,IAAI,GAAE,CAAG;;;;;eAC1B,MAAQ;gBAAI,KAAK,GAAE,QAAU;gBAAE,OAAO;;;gBAEtC,yBAAyB,OAAM,GAAK;oBAAI,KAAK,GAAE,SAAW;;;eAE1D,MAAQ;gBAAI,KAAK,GAAE,QAAU;gBAAE,OAAO;;;;;QAE1C,iBAAiB;YAAG,aAAa;;;;MAGxB,KAAI,IAAI,KAAY,MAC7B,GAAK;QAAI,KAAK,GAAE,gBAAkB;;WAChC,EAAI;;;;WACJ,GAAK;YAAI,KAAK;gBAAI,IAAI,GAAE,CAAG;;;eACzB,KAAO;gBAAI,KAAK;oBAAI,OAAO,GAAE,IAAM;;;;mBAEjC,KAAO;oBACP,KAAK;wBAAI,UAAU,GAAE,IAAM;;oBAC3B,IAAI,GAAE,QAAU;oBAChB,OAAO,EAAE,KAAK,CAAC,mBAAmB;oBAClC,QAAQ;;;YAGZ,SAAS,CAAC,KAAK;eACb,MAAQ;gBAAI,OAAO;gBAAyB,KAAK,GAAE,QAAU;;sBAAU,SAAW;;;WAEpF,MAAQ;YAAI,OAAO;YAAY,KAAK,GAAE,QAAU;;;;;;MAGzC,SAAS,MACpB,kBAAkB,GAClB,UAAU,SAMR,OAAS;QAEP,KAAK,GAAE,MAAQ;QACf,KAAK;YAAI,MAAM,GAAE,MAAQ;;;WAIvB,OAAS;YAEP,KAAK;gBACH,UAAU,GAAE,IAAM;;;kBAGhB,KAAO;;WAEb,GAAK;;iBAAY,IAAI,CAAC,SAAS;gBAAG,kBAAkB;gBAAE,UAAU;eAAI,IAAI,EAAE,CAAC;;;;MAItE,oBAAoB,IAAI,wBAAiC,MAElE,GAAK;QAEH,KAAK,GAAE,WAAa;QACpB,KAAK;YACH,QAAQ,GAAE,QAAU;YACpB,GAAG,GAAE,CAAG;YACR,IAAI,GAAE,CAAG;YACT,KAAK,GAAE,KAAO;YACd,MAAM,GAAE,0BAA4B;YACpC,UAAU,GAAE,MAAQ;YACpB,cAAc,GAAE,MAAQ;YACxB,UAAU,EAAE,wBAAwB,IAAG,qBAAuB,KAAG,WAAa;YAC9E,UAAU,GAAE,IAAM;YAClB,aAAa,EAAE,wBAAwB,IAAG,IAAM,KAAG,IAAM;;;WAKzD,GAAK;YAEH,KAAK,GAAE,kBAAoB;YAC3B,KAAK;gBACH,OAAO,GAAE,IAAM;gBACf,SAAS,EAAE,wBAAwB,IAAG,CAAG,KAAG,MAAQ;gBACpD,SAAS,GAAE,MAAQ,KAAI,wBAAwB,IAAG,CAAG,KAAG,GAAK,MAAI,CAAG;iBACpE,YAAc,IAAE,IAAM;iBACtB,kBAAoB,IAAE,IAAM;gBAC5B,UAAU,EAAE,wBAAwB,IAChC,gFAAkF,KAClF,sFAAwF;;;eAI5F,CAAG;gBAAI,KAAK;oBAAI,aAAa,GAAE,IAAM;;;;;eAGrC,MAAQ;gBAAI,KAAK,GAAE,gBAAkB;gBAAE,OAAO;;;;;;;;MC1NpD,kBAAkB,IAAI,QAAyB,IAAI,IAAI,GAAE,MAAM;QAC/D,MAAM,GAAG,WAAW;QACtB,QAAQ,CAAC,MAAM;OACd,IAAI;eACM,aAAa,CAAC,MAAM;;;MAG7B,UAAU,IAAI,IAAY,EAAE,MAAqB;QACrD,kBAAkB;;YAChB,IAAI;YAAE,MAAM;;;;eAGD,OAAO;;WAGb,iBAAiB,EAAE,yBAAyB,UAA+B,OAAO,CAAC,GAAG;WACxF,cAAc;WACd,yBAAyB;0BACV,IAAI;;;QAItB,IAAI;YACF,UAAU,EAAE,iBAAiB;YAC7B,kBAAkB,EAAE,yBAAyB;YAC7C,aAAa;YACb,IAAI,OAAO,MAAM;YACjB,WAAW,EAAE,IAAI,CAAC,GAAG;YACrB,mBAAmB,EAAE,KAAK;YAC1B,wBAAwB,EAAE,KAAK;YAC/B,yBAAyB,EAAE,KAAK;;QAElC,IAAI,GAAG,KAAK;YACV,OAAO,CAAC,GAAG,EAAC,sBAAwB,GAAE,KAAK;iCACtB,KAAK;;QAE5B,IAAI,EAAE,QAAQ,CAAC,cAAc,EAAC,SAAW;QACzC,aAAa,GAAG,KAAK;gBAAM,KAAK,CAAC,IAAI,UAAU,MAAM,IAAI,UAAU,CAAC,KAAK;;;;AAI7E,OAAO"}